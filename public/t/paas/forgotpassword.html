<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  -->
  <title>忘记密码</title>
  <meta name="description" content="xBoson 平台 - Web Portal">
  <meta name="keywords" content="xBoson 平台">
  <meta name="author" content="上海竹呗信息技术有限公司">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- Basic Styles -->
  <link rel="stylesheet" type="text/css" media="screen" href="lib/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" media="screen" href="lib/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" media="screen" href="lib/css/smartadmin-production.css">
  <link rel="stylesheet" type="text/css" media="screen" href="lib/css/smartadmin-skins.css">

  <style type="text/css">
  .has-error input[type="newpassword"],
  .has-error input[type="newpassword"] + .input-group-addon {
    border-color: #b94a48;
  }
  .has-error input[type="newpassword"]:focus,
  .has-error input[type="newpassword"]:focus + .input-group-addon {
    border-color: #b94a48;
  }
  .has-error input[type="text"]:focus,
  .has-error input[type="text"]:focus + .input-group-addon {
    border-color: #b94a48;
  }
  .zy-logo {
    width: 58px;
    /*  background-color: #a0c2ce;*/
    /*  overflow: hidden;*/
  }
  .zy-logo .habra {
    font: 800 48px Tahoma;
    line-height: 33px;
    text-shadow: 0px 0px #819da6, 1px 1px #819da6, 2px 2px #819da6, 3px 3px #819da6, 4px 4px #819da6, 5px 5px #819da6, 6px 6px #819da6, 7px 7px #819da6, 8px 8px #819da6, 9px 9px #819da6, 10px 10px #819da6, 11px 11px #819da6, 12px 12px #819da6, 13px 13px #819da6, 14px 14px #819da6, 15px 15px #819da6, 16px 16px #819da6, 17px 17px #819da6, 18px 18px #819da6, 19px 19px #819da6, 20px 20px #819da6, 21px 21px #819da6, 22px 22px #819da6, 23px 23px #819da6, 24px 24px #819da6, 25px 25px #819da6, 26px 26px #819da6, 27px 27px #819da6, 28px 28px #819da6;
  }
  </style>
</head>

<body id="login" class="animated fadeInDown container-full">
  <!-- possible classes: minified, no-right-panel, fixed-ribbon, fixed-header, fixed-width-->
  <header id="header">
    <div id="logo-group">
      <span id="logo" style="color:#A0C5E8;" class="zy-logo"> <i class="habra">Z</i>
        <span style="color:#04888D;text-shadow: 0 1px #021B1B;font-weight:bold;font-size:24px;">xBoson Portal</span>
      </span>
    </div>

    <span id="login-header-space">
      <span class="hidden-mobile">没有账户？</span>
      <a href="register.html" class="btn btn-danger">创建账户</a>
    </span>
  </header>

  <div id="main" role="main">
    <!-- MAIN CONTENT -->
    <div id="content" class="container">
      <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-8 hidden-xs hidden-sm">
          <h1 class="txt-color-red login-header-big">xBoson Portal</h1>
          <div class="hero">
            <div class="pull-left login-desc-box-l">
              <h4 class="paragraph-header">【xBoson】系列云计算相关产品，为智慧城市建设相关行业提供解决方案、混合云服务、中间件（含业务中间件）、大数据利用等。</h4>
              <div class="login-app-icons">
                <a href="javascript:void(0);" class="btn btn-danger btn-sm">智慧医疗</a>
                <a href="javascript:void(0);" class="btn btn-danger btn-sm">智慧水务</a>
              </div>
            </div>
            <img src="lib/img/demo/iphoneview.png" alt="" class="pull-right display-image" style="width:210px">
          </div>
          <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
              <h5 class="about-heading">合作伙伴</h5>
              <p>与微软、H3C、NEC等世界500强公司建立了合作伙伴关系。</p>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
              <h5 class="about-heading">共赢</h5>
              <p>将秉承创新、实干、合作、共赢的发展理念，以云计算PaaS、SaaS核心业务为主线，与合作伙伴共同发展、共享成功！</p>
            </div>
          </div>
        </div>

        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
          <div class="well no-padding">
            <div id="form-section" class="smart-form client-form">
              <header>忘记密码</header>
              <fieldset>
                <section class="row forgotpassword">
                  <div class="col col-6">
                    <button type="button" id="tel_forgotpassword" name="tel" class="btn btn-default btn-primary btn-lg btn-block">手机找回</button>
                  </div>
                  <div class="col col-6">
                    <button type="button" id="email_forgotpassword" name="email" class="btn btn-default btn-lg btn-block">邮箱找回</button>
                  </div>
                </section>
              </fieldset>
              <!-- 表单 -->
              <form id="forgotpassword-form" class="smart-form client-form form-group" onsubmit="return false;">
                <fieldset>
                  <section>
                    <label class="input">
                      <i class="icon-append fa fa-user"></i>
                      <input type="text" name="userid" placeholder="用户ID">
                    </label>
                  </section>
                  <section>
                    <label class="input verify" id="tel">
                      <i class="icon-append fa fa-phone"></i>
                      <input type="text" name="tel" placeholder="手机号码">
                    </label>
                  </section>
                  <section>
                    <label class="input verify" id="email">
                      <i class="icon-append fa fa-envelope"></i>
                      <input type="text" name="email" placeholder="电子邮箱">
                    </label>
                  </section>
                  <section>
                    <label class="input">
                      <i class="icon-append fa fa-lock"></i>
                      <input type="newpassword" name="newpassword" placeholder="新密码">
                    </label>
                  </section>
                  <section>
                    <div class="input-group">
                      <label class="input">
                        <input type="text" name="valwords" placeholder="验证码">
                      </label>
                      <label class="input-group-btn">
                        <input class="btn btn-primary btn-sm" style="height:32px;" type="button" id="get_valwords" name="get_valwords" value="获取验证码">
                      </label>
                    </div>
                  </section>
                </fieldset>
                <footer>
                  <button type="" id="forgotpassword-button" class="btn btn-primary">重置密码</button>
                </footer>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--================================================== -->

    <!-- PACE LOADER - turn this on if you want ajax loading to show (caution: uses lots of memory on iDevices)-->
    <script src="lib/js/plugin/pace/pace.min.js"></script>

    <!-- jQuery + jQueryUI -->
    <script src="lib/js/libs/jquery-1.11.0.min.js"></script>
    <script src="lib/js/libs/jquery-ui-1.10.3.min.js"></script>

    <!-- BOOTSTRAP JS -->
    <script src="lib/js/bootstrap/bootstrap.min.js"></script>

    <!-- CUSTOM NOTIFICATION -->
    <script src="lib/js/plugin/smart/SmartNotification.min.js"></script>

    <!-- JARVIS WIDGETS -->
    <script src="lib/js/plugin/smart/jarvis.widget.min.js"></script>

    <!-- JQUERY COOKIE -->
    <script src="lib/js/plugin/jquery-cookie/jquery.cookie.js"></script>

    <!-- JQUERY Storage API -->
    <script src="lib/js/plugin/jquery-storageapi/jquery.storageapi.min.js"></script>

    <!-- JQUERY FORM -->
    <script src="lib/js/plugin/jquery-form/jquery.form.min.js"></script>

    <!-- JQUERY VALIDATE -->
    <script src="lib/js/plugin/jquery-validate/jquery.validate.min.js"></script>
    <script src="lib/js/plugin/jquery-validate/messages_zh.js"></script>

    <!-- JQUERY MASKED INPUT -->
    <script src="lib/js/plugin/masked-input/jquery.maskedinput.min.js"></script>

    <!-- JQUERY SELECT2 INPUT -->
    <script src="lib/js/plugin/select2/select2.min.js"></script>

    <!-- JQUERY UI + Bootstrap Slider -->
    <script src="lib/js/plugin/bootstrap-slider/bootstrap-slider.min.js"></script>

    <!-- browser msie issue fix -->
    <script src="lib/js/plugin/msie-fix/jquery.mb.browser.min.js"></script>

    <!-- FastClick: For mobile devices -->
    <script src="lib/js/plugin/fastclick/fastclick.js"></script>

    <!--[if IE 7]>
    <h1>您的IE浏览器版本过低，请更换其它现代浏览器或更新您的IE浏览器 www.microsoft.com/download</h1>
    <![endif]-->

    <!-- ZY Script -->
    <script src="lib/js/zy/zy.js"></script>

    <!-- MAIN APP JS FILE -->
    <!--<script src="lib/js/app.js"></script>-->
    <script src="lib/js/app_extend.js"></script>
    <script type="text/javascript">
    $(function() {
      //打开控制台输出Log，用于调试
      Console.open();
      // 初始化
      //zy.g.host.ui = zy.net.getHttpUrl();
      //zy.g.host.api = zy.net.getHttpUrl("/ds/");
      Console.log("/forgotpassword.html 加载完成.........");
    });

    (function init() {
      //默认手机找回
      $('input[name=email]').detach();
      $('#tel_forgotpassword').btnDisable(true);
      $('#email_forgotpassword').btnDisable(false);
      //获取验证码
      verify();
      GetValwords();
    })();

    validator = $("#forgotpassword-form").validate({
      rules: {
        userid: {
          required: true,
          minlength: 4,
          maxlength: 16
        },
        tel: {
          required: true,
          tel: true
        },
        email: {
          required: true,
          email: true,
        },
        newpassword: {
          required: true,
          minlength: 6,
          maxlength: 16
        },
        valwords: {
          required: true,
          minlength: 6,
          maxlength: 6
        },
      },
      messages: {
        userid: {
          required: '请输入用户ID'
        },
        tel: {
          required: '请输入手机号码',
        },
        email: {
          required: '请输入电子邮箱',
        },
        newpassword: {
          required: '请输入新密码'
        },
        valwords: {
          required: '请输入验证码'
        },
      },
      onfocusout: function(element) {
        $(element).valid();
      },
      onkeyup: function(element) {
        $(element).valid();
      },
      errorElement: 'b',
      errorPlacement: function(error, element) {
        if (element.is(":checkbox")) {
          error.appendTo(element.parent()).css('color', 'red');
        } else {
          error.appendTo(element.parent()).addClass("tooltip tooltip-top-right");
        }
      },
      highlight: function(element, errorClass, validClass) {
        $(element).parent().addClass('has-error');
        $(element).parent().find('i').css('color', 'red');
      },
      unhighlight: function(element, errorClass, validClass) {
        $(element).parent().removeClass('has-error');
        $(element).parent().find('i').css('color', 'green');
      },
      submitHandler: function(form) {
        $('#forgotpassword-button').click(function(event) {
          Submit(form);
        });
      },
    });

    //自定义手机号码验证
    $.validator.addMethod("tel", function(value, element) {
      var length = value.length;
      var tel = /^(13[0-9]|14[57]|15[012356789]|17[678]|18[0-9])[0-9]{8}$/;
      return this.optional(element) || (length == 11 && tel.test(value));
    }, "请输入正确的手机号码");

    //手机找回、邮箱找回切换
    $('.forgotpassword').on("click", 'button', function() {
      $current = $(this); //当前按键
      $other = $(this).parent().siblings().find('button'); //另一按键
      currentName = $(this).attr('name');
      otherName = $(this).parent().siblings().find('button').attr('name');
      //密码找回按键切换
      $current.btnDisable(true).addClass('btn-primary');
      $other.btnDisable(false).removeClass('btn-primary');
      //密码找回表单切换
      $('input[name=' + otherName + ']').detach();
      if ($(this).is('#tel_forgotpassword')) {
        $('#' + currentName + '').parent().find('i').after('<input type="text" name="tel" placeholder="手机号码">');
      } else {
        $('#' + currentName + '').parent().find('i').after('<input type="text" name="email" placeholder="电子邮箱">');
      }
      //重置表单 清除样式
      $("#forgotpassword-form label").removeClass('has-error');
      $("#forgotpassword-form label i").removeAttr('style');
      validator.resetForm();
      $('#get_valwords').btnDisable(true);
      verify();
    });

    //手机或邮箱验证通过 验证码按键可用
    function verify() {
      $('#get_valwords').btnDisable(true);
      $('#forgotpassword-form label.verify input').blur(function() {
        if (validator.element($(this))) {
          $('#get_valwords').btnDisable(false);
        } else {
          $('#get_valwords').btnDisable(true);
        }
      }).keyup(function() {
        $(this).triggerHandler('blur');
      }).focus(function() {
        $(this).triggerHandler('blur');
      });
    }

    //验证码60s倒计时
    function GetValwords() {
      var countdown = 60;
      function time(o) {
        if (countdown == 0) {
          o.btnDisable(false);
          o.val('获取验证码');
          countdown = 60;
        } else {
          o.btnDisable(true);
          o.val("重新发送" + countdown);
          countdown--;
          setTimeout(function() {
            time(o);
          }, 1000);
        }
      }
      $('#get_valwords').on('click', function(event) {
        time($(this));
      });
    }

    //Form 提交注册
    function Submit(form) {
      var callback = function(msg) {
        if (msg) {
          Console.log("forgotpassword.success: " + JSON.stringify(msg));
          if (msg.ret == "0") {
            zy.ui.msg('提示信息：', '密码重置成功！', 's');
          }
        }
      };
      var error = function(msg) {
        if (msg) {
          if (msg.ret === '1001') {
            zy.ui.msg('提示信息：', '密码重置失败！', 'e');
          }
        }
      };
      Console.log('正在找回密码');
      zy.g.am.app = 'ZYAPP_LOGIN';
      zy.g.am.mod = 'ZYMODULE_REG';
      zy.net.post("user/reset_userpasswd", callback, $("#forgotpassword-form").serialize(), null, error);
    }
    </script>
</body>
</html>