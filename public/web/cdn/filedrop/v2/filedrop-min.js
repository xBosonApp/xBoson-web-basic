!function(t,n){"function"==typeof define&&define.amd?define(["exports"],function(e){n(t,e)}):"undefined"!=typeof exports?n(t,exports):n(t,t.fd=t.fd||{})}(this,function(t,p){p.randomID=function(e){return(e||"fd")+"_"+(1e4*Math.random()).toFixed()},p.uniqueID=function(e){do{var t=p.randomID(e)}while(p.byID(t));return t},p.byID=function(e){return p.isTag(e)?e:document.getElementById(e)},p.isTag=function(e,t){return"object"==typeof e&&e&&1==e.nodeType&&(!t||e.tagName.toUpperCase()==t.toUpperCase())},p.newXHR=function(){try{return new XMLHttpRequest}catch(e){for(var t=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<t.length;n++)try{return new ActiveXObject(t[n])}catch(e){}}throw"Cannot create XMLHttpRequest."},p.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},p.toArray=function(e,t){return null==e?[]:(p.isArray(e)||"object"==typeof e&&"callee"in e||(e=[e]),Array.prototype.slice.call(e,t||0))},p.addEvent=function(e,t,n){return e&&t&&n&&(e.attachEvent?(e["e"+t+n]=n,e[t+n]=function(){e["e"+t+n](window.event)},e.attachEvent("on"+t,e[t+n])):e.addEventListener(t,n,!1)),e},p.stopEvent=function(e){return e.cancelBubble=!0,e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e},p.setClass=function(e,t,n){return(e=p.byID(e))&&null!=t&&(void 0===n||n?p.hasClass(e,t)||(e.className+=" "+t):e.className=e.className.replace(p.classRegExp(t)," ")),e},p.hasClass=function(e,t){return p.classRegExp(t).test((p.byID(e)||{}).className)},p.classRegExp=function(e){return""==e||"object"==typeof e?/$o_O/:new RegExp("(^|\\s+)"+e+"(\\s+|$)","gi")},p.extend=function(e,t,n){for(var r in e=e||{},t=t||{})!n&&void 0!==e[r]||(e[r]=t[r]);return e},p.callAll=function(e,t,n){var r;if(t=p.toArray(t),"function"==typeof e&&(e=[e]),p.isArray(e))for(var o=0;o<e.length&&("function"!=typeof e[o]||null==(r=e[o].apply(n||this,t)));o++);else if(e)throw"FileDrop event list must be either an Array, Function, undefined or null but "+typeof e+" was given.";return r},p.callAllOfObject=function(e,t,n){var r;p.logging&&p.hasConsole&&(r=e.events[t]&&e.events[t].length||0,console.info("FileDrop "+t+" event ("+r+") args:"),console.dir([n]));var o=[p.onObjectCall].concat(e.events.any),i=p.callAll(o,[t].concat(p.toArray(n)),e);return null!=i?i:p.callAll(e.events[t],n,e)},p.appendEventsToObject=function(e,t){if(p.addEventsToObject(this,!1,arguments))return this;switch(arguments.length){case 0:return p.extend({},this.events);case 1:if(null===e)return this.events={},this;if(p.isArray(e)){for(var n={},r=0;r<e.length;r++)n[e[r]]=p.toArray(this.events[e[r]]);return n}if("function"==typeof e)return p.funcNS(e);if("string"==typeof e)return p.toArray(this.events[e]);case 2:if(e=p.toArray(e),null===t){for(r=0;r<e.length;r++){var o=p.splitNS(e[r]);if(o[0])if(o[1]){if(this.events[o[0]])for(var i=this.events[o[0]].length-1;0<=i;i--)p.funcNS(this.events[o[0]][i])==o[1]&&this.events[o[0]].splice(i,1)}else this.events[o[0]]=[];else for(var a in this.events)arguments.callee.call(this,[a+":"+o[1]],null)}return this}}throw"Bad parameters for FileDrop event()."},p.previewToObject=function(e,t){if(p.addEventsToObject(this,!0,arguments))return this;throw"Bad parameters for FileDrop preview()."},p.addEventsToObject=function(e,t,n){var r=n[0],o=n[1];switch(n.length){case 1:if(r&&"object"==typeof r&&!p.isArray(r)){for(var i in r)arguments.callee(e,t,[i,r[i]]);return!0}case 2:if("function"==typeof o||p.isArray(o)){r=p.toArray(r),o=p.toArray(o);for(var a=t?"unshift":"push",l=0;l<r.length;l++){for(var s=p.splitNS(r[l]),u=0;u<o.length;u++)p.funcNS(o[u],s[1]);e.events[s[0]]=e.events[s[0]]||[],e.events[s[0]][a].apply(e.events[s[0]],o)}return!0}}},p.funcNS=function(e,t){return"function"!=typeof e?e:1==arguments.length?(e[p.nsProp]||"").toString():(e[p.nsProp]=(t||"").toString(),e)},p.splitNS=function(e){return(e||"").match(/^([^:]*):?(.*)$/).slice(1)},p.extend(p,{logging:!0,hasConsole:"console"in window&&console.log&&console.dir,onObjectCall:null,all:[],isIE6:!1,isIE9:!1,isChrome:-1!=(navigator.vendor||"").indexOf("Google"),nsProp:"_fdns"}),p.DropHandle=function(o,e){var i=this;if(i.el=o=p.byID(o),!o)throw"Cannot locate DOM node given to new FileDrop class.";i.opt={zoneClass:"fd-zone",inputClass:"fd-file",iframe:{url:"",callbackParam:"fd-callback",fileParam:"fd-file"},input:null,recreateInput:!0,fullDocDragDetect:!1,multiple:!1,dropEffect:"copy"},p.all.push(i),i.filedrop=null;var t=i.opt.iframe;p.extend(i.opt,e,!0),p.extend(i.opt.iframe,t),p.isChrome&&(i.opt.fullDocDragDetect=!0),i.events={any:[],dragEnter:[],dragLeave:[],dragOver:[],dragEnd:[],dragExit:[],upload:[],uploadElsewhere:[],inputSetup:[],iframeSetup:[],iframeDone:[]},i.on=i.events,i.zone=i.el,i.hook=function(e){0!=i.opt.input&&(i.opt.input=i.opt.input||i.prepareInput(e),i.opt.input&&p.callAllOfObject(i,"inputSetup",i.opt.input)),i.hookDragOn(e),i.hookDropOn(e)},i.hookDragOn=function(e){i.opt.fullDocDragDetect?(i.delegate(document.body,"dragEnter"),p.addEvent(document,"dragleave",function(e){(0==e.clientX&&0==e.clientY||p.isTag(e.relatedTarget,"html"))&&(p.stopEvent(e),p.callAllOfObject(i,"dragLeave",e))})):(i.delegate(e,"dragEnter"),i.delegate(e,"dragLeave")),i.delegate(e,"dragOver"),i.delegate(e,"dragEnd"),i.delegate(e,"dragExit")},i.hookDropOn=function(e){p.isIE9||i.delegate(e,"drop","upload")},i.delegate=function(e,t,n){p.addEvent(e,t.toLowerCase(),function(e){p.stopEvent(e),p.callAllOfObject(i,n||t,e)})},i.prepareInput=function(e){var t=i.findInputRecursive(e)||i.createInputAt(e);if(t){for(var n=t.parentNode;n&&!p.isTag(n,"form");)n=n.parentNode;if(!n)throw"FileDrop file input has no parent form element.";var r=n?n.getAttribute("target"):"";if(r&&p.isTag(p.byID(r),"iframe"))return{file:t,form:n}}return!1},i.findInputRecursive=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(p.isTag(n,"input")&&"file"==n.getAttribute("type")&&p.hasClass(n,i.opt.inputClass))return n;if(n=arguments.callee(n))return n}},i.createInputAt=function(e){do{var t=p.randomID()}while(p.byID(t));var n=document.createElement("div");n.innerHTML='<iframe src="javascript:false" name="'+t+'"></iframe><form method="post" enctype="multipart/form-data"><input type="hidden" name="'+i.opt.iframe.callbackParam+'" /><input type="file" name="'+i.opt.iframe.fileParam+'" /></form>',n.firstChild.setAttribute("id",t),n.firstChild.style.display="none",n.lastChild.setAttribute("target",t);for(var r=e.firstChild;r&&(!p.isTag(r)||p.isTag(r,"legend"));)r=r.nextSibling;return r?e.insertBefore(n,r):e.appendChild(n),n.lastChild.lastChild},i.abortIFrame=function(){var e;!i.opt.input.form||(e=p.byID(i.opt.input.form.getAttribute("target")))&&e.setAttribute("src","javascript:false")},i.sendViaIFrame=function(t){t=t||i.opt.iframe.url;var e=(i.opt.input||{}).form;if(t&&e){do{var n=p.randomID()}while(n in window);window[n]=function(e){"object"!=typeof e&&(e={response:e,responseXML:"",responseText:(e||"").toString(),readyState:4,status:200,statusText:"OK",getAllResponseHeaders:function(){return""},getResponseHeader:function(){return""},setRequestHeader:function(){return this},statusCode:function(){return this},abort:function(){return this}}),p.extend(e,{iframe:!0,url:t}),p.callAllOfObject(i,"iframeDone",e)};for(var r=e.firstChild;r&&(!p.isTag(r,"input")||r.name!=i.opt.iframe.callbackParam);)r=r.nextSibling;return r?r.value=n:t=t.replace(/[?&]+$/,"")+(-1==t.indexOf("?")?"?":"&")+i.opt.iframe.callbackParam+"="+n,e.setAttribute("action",t),p.callAllOfObject(i,"iframeSetup",e),e.submit(),setTimeout(i.resetForm,300),!0}},i.resetForm=function(){var e,t=i.opt.input&&i.opt.input.file;t&&(t.value="",i.opt.recreateInput&&(e=i.opt.input.file=t.cloneNode(!0),t.parentNode.replaceChild(e,t),p.callAllOfObject(i,"inputSetup",[i.opt.input,t])))},i.multiple=function(e){return i.opt.input&&void 0!==e&&(e?i.opt.input.file.setAttribute("multiple","multiple"):i.opt.input.file.removeAttribute("multiple")),i.opt.input&&!!i.opt.input.file.getAttribute("multiple")},i.event=function(e,t){return p.appendEventsToObject.apply(i,arguments)},i.preview=function(e,t){return p.previewToObject.apply(i,arguments)},i.onInputSetup=function(e,t){t?(e.file.clearAttributes&&e.file.clearAttributes(),e.file.mergeAttributes&&e.file.mergeAttributes(t)):i.multiple(i.opt.multiple),p.setClass(e.file,i.opt.inputClass),i.delegate(e.file,"change","upload");var n,r=e.file.parentNode;r&&r.style.display.match(/^(static)?$/)&&(r.style.position="relative"),p.isTag(o,"fieldset")&&((n=document.createElement("div")).style.position="relative",n.style.overflow="hidden",o.parentNode.insertBefore(n,o),n.appendChild(o))},i.onDragOver=function(e){p.stopEvent(e),e.dataTransfer&&(e.dataTransfer.dropEffect=i.opt.dropEffect)},i.onUpload=function(){for(var e=0;e<p.all.length;e++)p.all[e]!==i&&p.all[e].events&&p.callAllOfObject(p.all[e],"uploadElsewhere",i)},i.event({inputSetup:i.onInputSetup,dragOver:i.onDragOver,upload:i.onUpload}),p.setClass(o,i.opt.zoneClass),i.hook(o)},p.FileDrop=function(t,e){var f=this;function n(e){return function(){p.setClass(t,f.opt.dragOverClass,e)}}t=p.byID(t),f.handle=new p.DropHandle(t,e),f.handle.filedrop=f,p.extend(f.handle.opt,{dragOverClass:"over"}),p.extend(f.handle.opt.iframe,{force:!1}),p.extend(f.handle.events,{send:[],fileSetup:[]}),f.onUpload=function(e){var t=!f.opt.iframe.force&&f.eventFiles(e,!0);t?0<t.length&&p.callAllOfObject(f,"send",[t]):!f.handle.sendViaIFrame()&&p.hasConsole&&console.warn("FileDrop fallback upload triggered but iframe options were not configured - doing nothing.")},f.eventFiles=function(e,t){var n,r=new p.FileList(e);if(n=e.dataTransfer&&(e.dataTransfer.length||e.dataTransfer.files)?e.dataTransfer:e.target&&e.target.files||e.srcElement&&e.srcElement.files){var o=n.items||[];n.files&&(n=n.files);for(var i={},a=0;a<n.length;a++){var l=n[a],s=new p.File(l),u=l.webkitRelativePath||s.name;i[u]&&"image.jpg"!=s.name||(i[u]=!0,s.setNativeEntry(o[a]),p.callAllOfObject(f,"fileSetup",s),(0<s.size||s.nativeEntry)&&r.push(s))}}else t&&(r=!1);return r},p.extend(f,f.handle),f.event({upload:f.onUpload,send:f.resetForm,dragEnter:n(!0),dragLeave:n(!1),uploadElsewhere:n(!1)}),f.preview({upload:n(!1)})},p.FileList=function(e){var i=this;i.dropEffect=e&&e.dropEffect||"",i.length=0,e=null,i.push=function(e){return i[i.length++]=e,i},i.pop=function(){if(0<i.length){var e=i.last();return delete i[--i.length],e}},i.first=function(){return i[0]},i.last=function(){return i[i.length-1]},i.remove=function(e){for(;e<i.length-1;e++)i[e]=i[e+1];return se.f.pop(),i},i.clear=function(){for(var e=0;e<i.length;e++)delete i[e];return i.length=0,i},i.reverse=function(){for(var e=0;e<Math.floor(i.length/2);e++)i[e]=i[i.length-e-1];return i},i.concat=function(e){for(var t=new p.FileList,n=0;n<i.length;n++)t[n]=i[n];for(n=0;e&&n<e.length;n++)t[i.length+n+1]=e[n];return t.length=i.length+(e||[]).length,i},i.sort=function(e,t){for(var n=0;n<i.length;n++)for(var r,o=0;o<i.length;o++){e.call(t||this,i[n],i[o],n,o)<0&&(r=i[n],i[n]=i[o],i[o]=r)}return i},i.sortBy=function(e,t){for(var n=[],r=0;r<i.length;r++)n.push([r,e.call(t||this,i[r],r)]);n.sort(function(e,t){return e[1]>t[1]?1:e[1]<t[1]?-1:0});for(r=0;r<n.length;r++)i[r]=n[r][0];return i},i.find=function(e,t){for(var n=0;n<i.length;n++){if(null!=e.call(t||this,i[n],n))return i[n]}},i.each=function(e,t){return i.find(function(){e.apply(this,arguments)},t),i},i.invoke=function(t,e){var n=p.toArray(arguments,1);return this.each(function(e){e[t].apply(e,n)})},i.abort=function(){return this.invoke("abort")},i.findCompare=function(e,t){var n;return i.each(function(e){n=e},t),n},i.filter=function(t,e){var n=new p.FileList;return i.each(function(e){t.apply(this,arguments)&&n.push(e)},e),n},i.largest=function(){return i.findCompare(function(e){return e.size})},i.smallest=function(){return i.findCompare(function(e){return-e.size})},i.oldest=function(){return i.findCompare(function(e){return-e.modDate.getTime()})},i.newest=function(){return i.findCompare(function(e){return e.modDate})},i.ofType=function(t){return t+=-1==t.indexOf("/")?"/":"$",t=new RegExp("^"+t,"i"),i.filter(function(e){return t.test(e.type)})},i.images=function(){return i.ofType("image")},i.named=function(t){return"string"==typeof t?i.find(function(e){return e.name==t}):i.filter(function(e){return t.test(e.name)})}},p.FileList.prototype.length=0,p.FileList.prototype.splice=Array.prototype.splice,p.File=function(t){var s=this;s.nativeFile=t,s.nativeEntry=null,s.name=t.fileName||t.name||"",s.size=t.fileSize||t.size||0,s.type=s.mime=t.fileType||t.type||"",s.modDate=t.lastModifiedDate||new Date,s.xhr=null,s.opt={extraHeaders:!0,xRequestedWith:!0,method:"POST"},s.events={any:[],xhrSetup:[],xhrSend:[],progress:[],done:[],error:[]},s.events.sendXHR=s.events.xhrSend,s.abort=function(){return s.xhr&&s.xhr.abort&&s.xhr.abort(),s},s.sendTo=function(e,t){var n;return(t=p.extend(t,s.opt)).url=e,s.size?window.FileReader?((n=new FileReader).onload=function(e){s.sendDataReadyTo(t,e)},n.onerror=function(e){p.callAllOfObject(s,"error",[e])},n.readAsArrayBuffer(s.nativeFile)):s.sendDataReadyTo(t):p.hasConsole&&console.warn("Trying to send an empty FileDrop.File."),s},s.sendDataReadyTo=function(e,t){var n;s.abort(),s.xhr=p.newXHR(),s.hookXHR(s.xhr),s.xhr.open(e.method,e.url,!0),s.xhr.overrideMimeType&&s.xhr.overrideMimeType("application/octet-stream"),s.xhr.setRequestHeader("Content-Type","application/octet-stream"),e.extraHeaders&&(s.xhr.setRequestHeader("X-File-Name",encodeURIComponent(s.name)),s.xhr.setRequestHeader("X-File-Size",s.size),s.xhr.setRequestHeader("X-File-Type",s.type),s.xhr.setRequestHeader("X-File-Date",s.modDate.toGMTString()),!0===(n=e.xRequestedWith)&&(n="FileDrop-XHR-"+(window.FileReader?"FileAPI":"Webkit")),n&&s.xhr.setRequestHeader("X-Requested-With",n)),p.callAllOfObject(s,"xhrSetup",[s.xhr,e]);var r=t&&t.target&&t.target.result?t.target.result:s.nativeFile;return p.callAllOfObject(s,"xhrSend",[s.xhr,r,e]),s.xhr},s.hookXHR=function(r){var e=r.upload||r;r.onreadystatechange=function(e){if(4==r.readyState){try{var t=200==r.status?"done":"error"}catch(e){t="error"}var n="error"==t?[e,r]:[r,e];p.callAllOfObject(s,t,n)}},e.onprogress=function(e){var t=e.lengthComputable?e.loaded:null;p.callAllOfObject(s,"progress",[t,e.total||null,r,e])}},s.readData=function(e,t,n){return s.read({onDone:e,onError:t,func:n})},s.readDataURL=function(e,t){return s.readData(e,t||!1,"uri")},s.readDataURI=s.readDataURL,s.read=function(n){function t(e,t){"object"==typeof t||(t.message=t),t.fdError=e,!1!==n.onError&&(n.onError||n.onDone).apply(this,arguments)}if(p.extend(n,{onDone:new Function,onError:null,blob:s.nativeFile,func:"",start:0,end:null,mime:""}),!window.FileReader)return t("support",e);(0<n.start||null!=n.end&&n.end)&&(n.blob.slice?(null==n.end&&(n.end=n.blob.size||n.blob.fileSize),n.blob=n.blob.slice(n.start,n.end,n.mime)):p.hasConsole&&console.warn("File Blob/slice() are unsupported - operating on entire File."));var r=new FileReader;r.onerror=function(e){t("read",e)},r.onload=function(e){e.target&&e.target.result?("readAsBinaryString"==n.func&&(e.target.result=String.fromCharCode.apply(null,new Uint8Array(e.target.result))),n.onDone(e.target.result)):r.onerror(e)};var o=n.func;if(p.isArray(o)){var i=o[0];return o[0]=n.blob,r[i].apply(r,o)}if(o&&"bin"!=o){if("url"==o||"uri"==o||"src"==o)o="readAsDataURL";else if("array"==o)o="readAsArrayBuffer";else if("text"==o)o="readAsText";else if("read"!=o.substr(0,4))return r.readAsText(n.blob,o)}else o="readAsBinaryString";return"readAsBinaryString"==o&&(o="readAsArrayBuffer"),r[o](n.blob)},s.listEntries=function(t,r){if(s.nativeEntry&&s.nativeEntry.isDirectory){r=r||new Function;var o=s.nativeEntry.createReader(),i=new p.FileList,a=0;function l(e){0==(a-=e)&&t&&(t(i),t=null)}return o.readEntries(function(e){for(var t=0;t<e.length;t++){var n=e[t];n.file?(a++,n.file(function(e){var t=new p.File(e);t.setNativeEntry(n),i.push(t),l(1)},function(){i.push(p.File.fromEntry(n)),l(1),r.apply(this,arguments)})):i.push(p.File.fromEntry(n))}t?o.readEntries(arguments.callee,r):l(0)},r),!0}},s.setNativeEntry=function(e){s.nativeEntry=e&&e.webkitGetAsEntry&&e.webkitGetAsEntry()},s.event=function(e,t){return p.appendEventsToObject.apply(s,arguments)},s.preview=function(e,t){return p.previewToObject.apply(s,arguments)},s.onXhrSend=function(e,t){e.send(t)},s.event({xhrSend:s.onXhrSend})},p.File.fromEntry=function(e){var t=new p.File(e);return t.setNativeEntry(e),t.nativeFile=null,t},p.jQuery=function(a){if(!(a=a||jQuery||window.jQuery))throw"No window.jQuery object to integrate FileDrop into.";a.fn.filedrop=function(e){function t(n,r){return function(e){var t=(r||[]).concat(p.toArray(arguments,1));return o.triggerHandler((n+e).toLowerCase(),t)}}var o=this,n=this.data("filedrop");if("string"==typeof e)if(n){if(void 0!==n[e]){var r=n[e];return"function"==typeof r?r.apply(n,p.toArray(arguments,1)):r}a.error("There's no method or property FileDrop."+e+".")}else a.error("$.filedrop('comment') needs an initialized FilrDrop on this element.");else if(e&&"object"!=typeof e)a.error("Invalid $.filedrop() parameter - expected nothing (creates new zone), a string (property to access) or an object (custom zone options).");else if(n){if(!e)return n;p.extend(n.opt,e,!0)}else{var i=new FileDrop(this[0],e);i.$el=a(this),this.first().data("filedrop",i),i.event("any",t("fd")),i.on.fileSetup.push(function(e){e.event("any",t("file",[e]))})}return o}},t.FileDrop=p.FileDrop});