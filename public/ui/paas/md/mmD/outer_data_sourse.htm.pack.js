$("#outer_data_sourse_container").tabs();var outer_data_sourse=function(){function t(t){i=t,e()}function e(){o.tabs({active:0,activate:function(t,e){var a=e.newTab.parent().children().index(e.newTab);0===a||1===a&&void 0==d&&n()}}),a()}function a(){function t(t){var e=[{data:"table_name",title:"表名"},{data:"column_name",title:"列名"},{data:"is_nullable",title:"是否为NULL"},{title:"默认值",data:"column_default"},{title:"列类型",data:"column_type"},{title:"是否主键",data:"column_key"},{title:"列注释",data:"column_comment",defaultContent:""}],a={data:t,columns:e};$.extend(a,zy.ui.dataTable),o.dataTable(a)}function e(t){var e=function(t){return function(e){var a=0,n={};return function(i,d){n[i]=d,a++,a==t&&e&&e(n)}}}(t);return e}function a(){function t(t,a){function n(t,e,a){function n(){function t(t,e,a){return!e.isParent}function e(t,e,a){a&&"left"==e&&d.find("[name=decd0]").val(a.typecd)}function a(t,e){var a=$("#"+e.tId+"_span");if(!(e.editNameFlag||$("#addBtn_"+e.tId).length>0||$("#editBtn_"+e.tId).length>0)){var n="<span class='button add' id='addBtn_"+e.tId+"' title='添加' onfocus='this.blur();'></span>",o="<span class='button edit' id='editBtn_"+e.tId+"' title='修改' onfocus='this.blur();'></span>";0==e.level?a.after(n):(a.after(n),a.after(o)),$("#addBtn_"+e.tId).bind("click",function(){return i.selectNode(e),d.modal("hide"),mm_h1._addModal(e,function(t){var a=t;i.addNodes(e,a),i.cancelSelectedNode(e),d.modal("show")},function(){i.cancelSelectedNode(e),d.modal("show")}),!1}),$("#editBtn_"+e.tId).bind("click",function(){return d.modal("hide"),i.selectNode(e),mm_h1._editModal(e,function(t){var a=t;e.typenm=a.typenm,e.shownm=a.shownm,e.datatable=a.datatable,i.updateNode(e),i.cancelSelectedNode(e),d.modal("show")},function(){i.cancelSelectedNode(e),d.modal("show")}),!1})}}function n(t,e){$("#addBtn_"+e.tId).unbind().remove(),$("#editBtn_"+e.tId).unbind().remove()}return{view:{dblClickExpand:!1,addHoverDom:a,removeHoverDom:n,nameIsHTML:!0},data:{key:{name:"typenm",title:"shownm"},simpleData:{enable:!0,idKey:"typecd",pIdKey:"parentcd"}},callback:{beforeClick:t,onClick:e}}}var i=null,o=n();i=$.fn.zTree.init(t,o,e),a&&a(i)}var d=$("#md_mm_createobj"),o=e(2),c=o(function(e){var a=e.left,n=e.right;d.find("footer").find(".btn-primary").unbind().click(function(e){var o=a.getSelectedNodes(),c=n.getSelectedNodes(),l=d.find("[name=decd0]").val(),s=d.find("[name=decd1]").val(),u=1==d.find("input:checked[name=is_cre_ds]").length?1:0,m=1==d.find("input:checked[name=is_cre_tbl_link]").length?1:0;if(0==o.length)return zy.ui.msg("提示","请选择数据元","i");if(1==u){if(0==c.length)return zy.ui.msg("提示","请选择数据集","i")}else c=[{typecd:""}];if(""==l)return zy.ui.msg("提示","请选择或输入业务大类","i");if(""==s)return zy.ui.msg("提示","请输入业务小类","i");if(isNaN(s)||2!=s.length)return zy.ui.msg("提示","业务小类为两位数字","i");var f={dedir:o[0].typecd,dsdir:c[0].typecd,column:t,did:i.did,table_schema:i.table_schema,table_name:i.table_name,decd0:l,decd1:s,is_cre_ds:u,is_cre_tbl_link:m};r.api({app:"c879dcc94d204d96a98a34e0b7d75676",mod:"outdatasource",api:"creatededs",r_param:f},function(t){t&&"0"==t.ret&&(zy.ui.msg("提示","创建成功","s"),d.modal("hide"))})})});r.api({app:"c879dcc94d204d96a98a34e0b7d75676",mod:"outdatasource",api:"getdedstree"},function(t){var e=d.find("#left"),a=d.find("#right");n(e,t.result0,function(t){c("left",t)}),n(a,t.result1,function(t){c("right",t)}),d.modal("show")}),d.find("input[name=is_cre_ds]").change(function(){$(this).is(":checked")||d.find("input[name=is_cre_tbl_link]").attr("checked",!1)}),a||d.find("input[name=is_cre_tbl_link]").attr("checked",!1)}c.find("[name=createobj]").click(function(e){zy.net.loadHTML("md/mm/md_mm_outer_sourse.html",$("#md_mmD_index_modal"),function(){window.ee=o;var e=o.find("tr.active"),a=0==o.find("tbody").find("tr:not(.active)").length?1:0,n="";$.each(e,function(t,e){var a=$(e).index();n+=o.DataTable().row(a).data().column_name+","}),n=n.trimCom(),t(n,a)})}),c.find("[name=selectall]").click(function(t){var e=o.find("tbody").find("tr.active"),a=o.find("tbody").find("tr").not(".active");e.removeClass("active"),a.addClass("active"),a.length>0?c.find("[name=createobj]").btnDisable(!1):c.find("[name=createobj]").btnDisable(!0)}),c.find("[name=ddl]").click(function(){zy.net.loadHTML("md/mm/tab2_ddl_modal.html",$("#md_mmD_index_modal"),function(){ddl_modal(i)})}),c.find("[name=createobj]").btnDisable(!0),o.on("click","tr",function(t){return $(this).find("th").is("th")||$(this).find("td").hasClass("dataTables_empty")?!1:void(!$(this).find("div").hasClass("popover")&&$(this).hasClass("active")?($(this).removeClass("active"),0==o.find("tr.active").length&&c.find("[name=createobj]").btnDisable(!0)):($(this).addClass("active"),c.find("[name=createobj]").btnDisable(!1)))})}function n(){var e=function(e){e&&(t(e.result),c.find("[name=column_total_count]").html("总数："+e.result.length))};zy.g.am.app="c879dcc94d204d96a98a34e0b7d75676",zy.g.am.mod="outdatasource",zy.net.get("api/getouttablecolumns",e,{did:i.did,table_schema:i.table_schema,table_name:i.table_name})}d=void 0;var o=$("#outer_data_sourse_column_table");$("#outer_data_sourse_column_pagi");n(),a()}function n(){function t(t,e){var a=[];$.each(t,function(t,e){var n={title:e.cn,data:e.en};a.push(n)});var n={data:e,columns:a};$.extend(n,zy.ui.dataTable),d=o.dataTable(n)}function e(t){$.jqPaginator(c,{totalCounts:1,pageSize:zy.g.page.pagesize,currentPage:t,onPageChange:function(t){a(t)}})}function a(e){var a=function(a){a&&(t(a.type,a.data),l.find("[name=column_total_count]").html("总数："+a.count),c.jqPaginator("option",{totalCounts:a.count,pageSize:zy.g.page.pagesize,currentPage:e}),r.find("[type=submit]").button("reset"))};zy.g.am.app="c879dcc94d204d96a98a34e0b7d75676",zy.g.am.mod="outdatasource",zy.net.get("api/gettabledata",a,{did:i.did,table_name:i.table_name,wherearea:r.find("[name=wherearea]").val()},e,function(t){r.find("[type=submit]").button("reset"),zy.ui.msg("提示信息：",t.msg,"i")})}function n(){r.find("[type=submit]").click(function(){$(this).button("loading"),e(1)}),o.on("dblclick","tr",function(t){if($(this).find("th").is("th")||$(this).find("td").hasClass("dataTables_empty"))return!1;o.find("tr").each(function(t,e){!$(e).find("div").hasClass("popover")&&$(e).hasClass("active")&&$(e).removeClass("active")}),$(this).addClass("active");var e=$("#tab_second_modal"),a=new jsoneditor.JSONEditor($("#sec_jsoneditor").get(0),{});a.set(o.DataTable().row(".active").data()),e.modal("show")})}var o=(l.find("[name=tbldiv]"),l.find("[name=tbl]")),c=l.find("[name=tbl_pagi]"),r=l.find("[name=where_form]");n(),e(1)}var i,d,o=(t.prototype,$("#outer_data_sourse_container")),c=$("#tab_first"),l=$("#tab_second"),r={api:function(t,e){var a=function(t){e&&e(t)};zy.g.am.app=t.app,zy.g.am.mod=t.mod,zy.net.get("api/"+t.api,a,t.r_param,t.page)}};return t}();