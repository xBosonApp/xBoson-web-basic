!function(_,y){var w,l,m={"":1,html:1,htm:1,md:1},n="lib/js/ace/1.4.2/ace.js",C=_("#uploadfile_html_template").html(),r={edit:[{name:"名称",id:"filenm",type:"input",write:!0,width:6},{name:"类型",id:"type",type:"input",write:!0,width:6}]};function v(e){y.setEditorExOptions(e)}l=y.isXBosonSystem?function(e){return y.g.host.api+"app/"+y.g.comm.org+"/ZYAPP_IDE/ZYMODULE_UI_IDE/"+e}:function(e){return"http://"+location.host+"/api/"+_apinm},y.net.get("app/a297dfacd7a84eab9656675f61750078/ZYAPP_IDE/ZYMODULE_UI_IDE/file_ext_allow",function(e){w=e.data||{}});var x,u=220;function t(){var e,t=_("#ide"),a=_(window).resize(i).scroll(function(){n=a.scrollTop(),t.css("margin-top",n)}),n=0;function i(){x=a.height(),e=x-u,_("#maintree").css("height",e),_(".fix_size").css("height",e)}_.ready(i),i(),i}t();var z={_api:function(e,t,a,n){a||(a={});var i=a.cb="callback"+y.tool.random();_.ajax({url:l(e),dataType:"jsonp",data:y.fix_jsonp_parm(a),type:n||"GET",jsonpCallback:i,success:function(e){y.fix_xboson_data(e),e.ret=e.code,t(e)},error:function(e,t,a){y.log("Error: "+a.message)}})},_apis:function(e,t,a,n){_.ajax({url:l(e),data:a||{},type:n||"GET",success:function(e){y.fix_xboson_data(e),t(e)},error:function(e,t,a){y.log("Error: "+a.message)}})},_formPost:function(e,t,n,a){var i=l(e)+"?onweb=1&"+y.net.parseParam(y.g.comm);t.ajaxSubmit({url:i,type:"post",async:!0,cache:!1,dataType:"json",success:function(e){y.fix_xboson_data(e),n&&n(e)},error:function(e,t,a){n&&n({code:1,msg:a.message||t})},xhr:function(){var e=_.ajaxSettings.xhr();return a&&e.upload&&e.upload.addEventListener("progress",a),e}})},_post:function(e,t,a){_.post(l(e),a,function(e){y.fix_xboson_data(e),e.ret=e.code,t&&t(e)})},_label:function(e){return _("<"+e+"></"+e+">")},_image:function(e){return _("<"+e+"/>")},_arrToObj:function(e,t){if(t){var a={};_.each(e,function(e,t){a[t]=!0})}else{a=[];_.each(e,function(e,t){a.push(t)})}return a}};function f(e){window.onbeforeunload=e?function(){return parent.$("body").removeClass("animated fadeOutUp"),"请确认代码已提交"}:null,_(window).unbind("resize"),t()}function d(e,t){var a=_("#widget-grid").find("header .glyphicon-saved");var n=e.attr("id"),i=ace.edit(n);return _("#left-panel nav").bind("click",function(){i.container.remove()}),i.setTheme("ace/theme/ambiance"),t&&"htm"!=t?i.getSession().setMode("ace/mode/"+t):i.getSession().setMode("ace/mode/html"),i.$blockScrolling=1/0,v(i),i.commands.addCommand({name:"myCommand",bindKey:{win:"Ctrl+S",mac:"Command+S"},exec:function(e){a&&a.trigger("click")}}),{get:function(){return i.getValue().trim()},set:function(e,t,a){""==i.getValue().trim()?(setTimeout(function(){i.getSession().getUndoManager().reset()},1),i.setValue(e+"\n\n\n\n\n"),i.navigateFileStart(),i.setReadOnly(t)):y.ui.msg(a||"","文件已经在IDE中打开","i")},initSize:function(){i.setShowPrintMargin(!1),i.setFontSize(13.5),i.setHighlightSelectedWord(!0),i.setOption("wrap",120),i.setOption("tabSize",2)}}}function k(e,t){e.wid;var a=e.tree.ztree,d=e.mod;function h(e,t,a){var n=_.fn.zTree.getZTreeObj("maintree"),i=_.fn.zTree.getZTreeObj("resulttree"),l=n&&n.getNodeByParam("path",e.path,null),r=i&&i.getNodeByParam("path",e.path,null);if("e"===t&&(l&&(_.extend(!0,l,a),n.updateNode(l),n.refresh()),r&&(_.extend(!0,r,a),i.updateNode(r))),"a"===t&&(l&&n.addNodes(l,a),r&&i.addNodes(r,a)),"r"===t){if(l){var d=l.getParentNode();n.removeNode(l),d.isParent=!0,n.updateNode(d)}if(r){var s=r.getParentNode();i.removeNode(r),0===s.level&&0===s.children.length&&(i.destroy(),_("#resulttree").parent().append(z._label("div").css({"text-align":"center","vertical-align":"middle"}).html("空"))),s.isParent=!0,i.updateNode(s)}}}var u=null;function s(p,c,e){var n=p;e&&_.each(c,function(e,t){var a=n.find("[name="+e+"]");0<a.length&&(a.hasClass("select2-offscreen")?a.select2("val",t.replace(/(.0)$/g,"")):a.val(t.replace(/(.0)$/g,"")))});var t=n.find("[name=ide_submit]");t.unbind(),t.click(function(){var i,e=_(".modal-body").find("[type=input]").val(),t=_("input[name=type]:checked").val();if("文件夹"===t)i=e.toLowerCase(),t=null;else{var a=[e,t].join(".");i=a.toLowerCase()}var n=e.length;if(l=!0,p.children().find("input").each(function(e,t){if(_(t).attr("name")&&"updatedt"!==_(t).attr("name")&&"createdt"!==_(t).attr("name")&&""===_(t).val()&&"type"!=_(t).attr("name"))return y.ui.msg("提示",_(t).attr("placeholder")+"不可为空","w"),l=!1}),l){var l,r,d="修改文件名"===_(this).closest(".modal-content").find("h4").text(),s=_.extend(!0,{},{path:c.path},(r={},p.find("input").each(function(e,t){var a=_("input[name=type]:checked").val();"文件夹"===a?(_(t).attr("role")||(r[_(t).attr("name")]=_(t).val()),"type"===_(t).attr("name")&&(r.type=!1)):([_(t).val(),a].join("."),_(t).attr("role")||(r[_(t).attr("name")]=_(t).val()),"type"===_(t).attr("name")&&(r.type=!0))}),r),y.g.comm);if(s.ext_name=t,/(^[\u4e00-\u9fa5a-zA-Z0-9_\-\.]+$)/.test(e))if(d)if(60<n)y.ui.msg("提示信息","名称必须在60个字以内","w");else{var o=c.getParentNode();f(o.path,function(e){var t=e;_.isArray(t)?o.children=t:o.children=t.children;var n=!1;_.each(o.children,function(e,t){var a=t.name.toLowerCase();if(i==a)return!(n=!0)}),n?y.ui.msg("提示信息","存在","e"):z._api("rename",function(e){Boolean(e.ret)?y.ui.msg("提示信息","接口执行失败:"+e.msg,"e"):(h(c,"e",e.result),y.ui.msg("提示信息","修改成功"+e.msg,"s"),_(".modal").modal("hide"),e.result||f(o.path,function(e){var t=e;_.isArray(t)?o.children=t:o.children=t.children,o.open=!0,u.updateNode(o),u.refresh()},!1))},s)},!1)}else 60<n?y.ui.msg("提示信息","名称必须在60个字以内","w"):f(c.path,function(e){var t=e;_.isArray(t)?c.children=t:c.children=t.children;var n=!1;_.each(c.children,function(e,t){var a=t.name.toLowerCase();if(i==a)return!(n=!0)}),n?y.ui.msg("提示信息","存在","e"):z._api("mkfile",function(e){Boolean(e.ret)?y.ui.msg("提示信息","接口执行失败:"+e.msg,"e"):f(c.path,function(e){var t=e;_.isArray(t)?c.children=t:c.children=t.children,c.open=!0,u.updateNode(c),u.refresh(),y.ui.msg("提示信息","新增成功","s"),_(".modal").modal("hide")},!1)},s)},!1);else y.ui.msg("提示信息","不准输入除中文、字母、数字以外的特殊字符","w")}})}function o(n){var i=n.name,e=i.split(".").length,l=n.name.split(".")[e-1];/^(png)$|^(jpg)$|^(jpeg)$|^(gif)$|^(ico)$|^(htm)$|^(html)$|^(js)$|^(css)$|^(woff2)$|^(woff)$|^(ttf)$|^(svg)$|^(eot)$|^(zip)$|^(rar)$|^(psd)$|^(ai)$|^(mp4)$|^(m4v)$|^(pdf)$|^(txt)$|^(md)$|^(swf)$|^(doc)$|^(ppt)$|^(xls)$/.test(l)?_lastname=l:_lastname="文件夹",y.net.loadHTML("ide/uiide/ide_edit.html",d,function(){if(n.isParent)n.name;else{var e=l.length,t=i.length-(e+1);n.name.substr(0,t)}var a={filenm:n.name};_(".modal-title").html("修改文件名"),_(".modal-body").empty(),d._form(_(".modal-body"),r.edit,a),_(".modal").modal("show"),function(e){e.empty();var t,a,n=z._label("div").addClass("inline-group");n.append((t=_lastname,(a=z._label("label").addClass("radio")).html(t).append(z._label("input").attr({type:"radio",name:"type",checked:!0,value:_lastname})).append(z._label("i")),a)),e.append(n)}(_(".modal-body").find("[name=type]").parent()),s(d.find("form"),n,!0)})}function f(e,a,t){var n={};_.extend(!0,n,y.g.comm),n.path=e,z._api("getfilelist",function(e){if(console.log(e,!Boolean(e.ret)),Boolean(e.ret))y.ui.msg("提示","接口执行失败:"+e.msg,"e");else{var t=e.result;_.isArray(t)?t=i(t):t.children=i(t.children),a&&a(t)}},n)}function i(e){var a=[],n=[];return _.each(e,function(e,t){t.isParent?n.push(t):a.push(t)}),[].concat(n,a)}var n={view:{showTitle:!0,selectedMulti:!1,showIcon:!0,dblClickExpand:!1},data:{key:{name:"name",title:"path"},simpleData:{enable:!1},keep:{parent:!0}},edit:{drag:{isCopy:!1,isMove:!1},showRenameBtn:!1,showRemoveBtn:!1,enable:!0}};n.callback={onExpand:function(e,t,a){a.children&&0!==a.children.length||f(a.path,function(e){var t=e;a.children=t,u.refresh()},!1)},onClick:function(e,a,n){if(n.isParent&&_("#zy_tabs").closest(".row").children(":last").find("[type=text]").val(n.path),!n.isParent){var t={path:n.path,orgid:y.g.comm.org},i=e.target;if(!_(i).attr("title")){if(!n)return;var l,r=_("#widget-grid").find("header .glyphicon-saved").parent(),d=_("#widget-grid").find("header .glyphicon-play").parent(),s=n.name,o=s.split(".").length,p=s.split(".")[o-1];if(a=(s+n.path).replace(/\//g,"").replace(/\./g,""),/^(png)|(jpg)|(jpeg)|(gif)|(ico)/.test(p))l=y.isXBosonSystem?y.g.host.ui:"/web/zr",_path=l+n.path,B.add(s,n.path,a,p,_path).inputc.val("");else z._api("getcontent",function(e){if(Boolean(e.ret))y.ui.msg("提示","接口执行失败:"+e.msg,"e");else{var t=B.add(s,n.path,a);t.inputc.val(""),j(function(){$.set(e.result.content,!1,n.path),$.initSize(),r.show()},t.pre,e.result.filetype),m[e.result.filetype]?d.show():d.hide()}},_.extend(!0,t,y.g.comm))}}}},n.view.addHoverDom=function(e,a){var t=_("#"+a.tId+"_span");if(!(a.editNameFlag||0<_("#addBtn_"+a.tId).length||0<_("#editBtn_"+a.tId).length||0<_("#remBtn_"+a.tId).length)){var n="<span class='button add' id='addBtn_"+a.tId+"' title='添加' onfocus='this.blur();'></span>",i="<span class='button edit' id='editBtn_"+a.tId+"' title='修改' onfocus='this.blur();'></span>",l="<span class='button remove' id='remBtn_"+a.tId+"' title='删除' onfocus='this.blur();'></span>",r=a.tId;/maintree/.test(r)&&0!==a.level&&t.after(l).after(i),a.isParent&&t.after(n),0===a.level&&-1<a.tId.indexOf("resulttree")&&_("#addBtn_"+a.tId).unbind().remove(),_("#remBtn_"+a.tId).bind("click",function(){var e;e=a.isParent?"删除文件夹会删除其中包含的文件，确认要删除":"确认要删除",y.ui.mask("请确认",e+a.name+"?",function(){var t={};t.path=a.path,y.g.am.app="ZYAPP_IDE",y.g.am.mod="uiidemod",y.net.get("api/save_remove",function(e){"0"==e.ret&&z._api("remove",function(e){return Boolean(e.ret)?y.ui.msg("提示信息","接口执行失败,"+e.msg,"e"):(h(a,"r"),y.ui.msg("提示信息",e.msg,"s"))},_.extend(!0,t,y.g.comm))},null)})}),_("#addBtn_"+a.tId).bind("click",function(){return u.selectNode(a),function(e){y.net.loadHTML.call(this,"ide/uiide/ide_edit.html",d,function(){_(".modal-title").html("创建新文件"),_(".modal").modal("show"),s(d.find("form"),e,!1)})}(a),!1}),_("#editBtn_"+a.tId).bind("click",function(){return u.selectNode(a),o(a),!1})}},n.view.removeHoverDom=function(e,t){_("#addBtn_"+t.tId).unbind().remove(),_("#editBtn_"+t.tId).unbind().remove(),_("#remBtn_"+t.tId).unbind().remove()},a.empty(),t?u=_.fn.zTree.init(a,n,t):f("/",function(e){u=_.fn.zTree.init(a,n,e)})}function j(e,t,a){y.net.loadScript.call(this,n,function(){$=d(t,a),e&&e()})}var $,s,e=function(e){function b(e,a,t){var n={};_.extend(!0,n,y.g.comm),n.path=e,z._api("getfilelist",function(e){if(Boolean(e.ret))y.ui.msg("提示","接口执行失败:"+e.msg,"e");else{var t=e.result;_.isArray(t)?t=i(t):t.children=i(t.children),a&&a(t)}},n)}function i(e){var a=[],n=[];return _.each(e,function(e,t){t.isParent?n.push(t):a.push(t)}),[].concat(n,a)}function o(){var a=!0,e=y.cache.get("_zy_user_info","ls"),n=y.g.comm.org,t=e.get("user_org_list");return _.each(t,function(e,t){t.orgid==n&&(a=t.isplatorg)}),a}function t(){var e,t,a,n,i=r.find(".jarviswidget-editbox"),l=z._label("div").addClass("row");l.append((e=function(t){$&&$.contentid&&(t.btnDisable(!0),z._api({apiid:"ucode",r_param:{contentid:$.contentid,content:$.get(),updatecmt:""}},function(e){Boolean(e.ret)?y.ui.msg("提示","接口执行失败:"+e.msg,"e"):(t.btnDisable(!1),y.ui.msg("提示信息","文件保存成功","s"))}))},t=z._label("a").addClass("btn btn-labeled btn-success pull-right").attr("href","javascript:void(0);").css("margin-right","17px"),a=z._label("span").addClass("btn-label"),n=z._label("i").addClass("glyphicon glyphicon-ok"),t.append(a.append(n)).append("提交"),t.click(function(){e&&e(_(this))}),t)),i.append(l)}var r=_("#"+e),f=z._label("div");f._form=function(e,t,a){var n,i,l,r,d=_.extend(!0,{},t),s=(n=d,i=[],l=[],r=[],_.each(n,function(e,t){12===t.width?l.push(t):"createdt"===t.id||"updatedt"===t.id?r.push(t):i.push(t)}),{half:i,full:l,time:r});function o(e){if(12!==e.width)var t=z._label("section").addClass("col col-"+e.width);else t=z._label("section");var a=z._label("label").addClass("label").html(e.name);if("textarea"===e.type)var n=z._label("label").addClass("textarea has-warning"),i=z._label("textarea").attr("name",e.id).attr("placeholder",e.name);else n=z._label("label").addClass("input has-warning"),i=z._label("input").attr("name",e.id).attr("type",e.type).attr("placeholder",e.name);"select2"===i.attr("type")&&i.attr("type","input"),e.write||i.attr("readonly","readonly");var l=z._label("b").addClass("tooltip tooltip-bottom-right").html(e.name+"为必填项");return n.append(i).append(l),t.append(a).append(n),t}function p(e){var t=e/2;return Math.round(t)===t}var c=z._label("form").attr("onsubmit","return false;").addClass("smart-form");c.append(_("<fieldset></fieldset>")),_.each(s.half,function(e,t){var a=e/2;if(p(e)){var n=z._label("div").addClass("row");c.children().append(n)}else a-=.5;c.find("div").eq(a).append(o(t))});var h,u,f,m,g,v=null;_.each(s.time,function(e,t){p(e)&&(v=z._label("div").addClass("row")),v.append(o(t)),c.children().append(v)}),_.each(s.full,function(e,t){c.children().append(o(t))}),h=c,u=z._label("footer"),f=z._label("button").addClass("btn btn-default").attr("data-dismiss","modal").html("取消"),m=z._label("button").addClass("btn btn-primary").attr("name","ide_submit").html("确定"),u.append(f).append(m),h.append(u),g=d,_.each(g,function(e,t){"status"===t.id&&y.cache.initDicts("ZR.0001",function(){c.find("[name="+t.id+"]").zySelect("ZR.0001",!1,{allowClear:!1,width:"100%"}),c.find("[name="+t.id+"]").select2("val","1")}),"auflag"===t.id&&y.cache.initDicts("ZR.0029",function(){c.find("[name="+t.id+"]").zySelect("ZR.0029",!1,{allowClear:!1,width:"100%"}),c.find("[name="+t.id+"]").select2("val","0")}),"optype"===t.id&&y.cache.initDicts("ZR.0010",function(){c.find("[name="+t.id+"]").zySelect("ZR.0010",!1,{allowClear:!1,width:"100%"}),c.find("[name="+t.id+"]").select2("val","0")})}),e.append(c),a&&_.each(a,function(e,t){c.find("[name="+e+"]").val(t)})};var a=z._label("div").addClass("row"),n=z._label("div").addClass("col-xs-12 col-sm-9").css({});n.unbind(),n.bind("size",function(e){_(this).removeClass();var t=_(this).siblings(":visible");if(0<t.length){var a=0;_.each(t,function(e,t){a+=Number(_(t).attr("class").replace(/col-xs-12 col-sm-/g,""))}),_(this).addClass("col-xs-12 col-sm-"+(12-a))}else _(this).addClass("col-xs-12 col-sm-12")});var l,d,s,p,c,h,u,m=z._label("pre").attr("id","zy_ide_editor"),t=z._label("div").addClass("col-xs-12 col-sm-3").css({display:"none"}),g=function(){var e,t,a,n=z._label("div").addClass("col-xs-12 col-sm-3");e=n,t=z._label("div").addClass("input-group input-group-sm").attr("style","width:100%;margin-bottom:-15px"),(a=z._label("header")).append(z._label("label").html("文件目录")).append(z._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(z._label("i").addClass("fa fa-times"))),e.append(t.append(a)),e.append(z._label("legend")),a.children("a").unbind(),a.children("a").click(function(){var e=_(this).closest(".col-sm-3");e.hide(),e.parent().children(":eq(1)").trigger("size")});var i=z._label("ul").addClass("ztree").attr("id","maintree");return n.append(z._label("div").attr("style","overflow: auto; height: 100%;").addClass("row").css("margin-top","-15px").append(i)),{container:n,ul:i}}();return r.closest("#widget-grid").after(f),m.attr("style","font-family:Consolas,Microsoft YaHei,微软雅黑,sans-serif,宋体;top:-14;height:100%; width:100%;"),a.append(g.container).append(n).append(t),r.find(".widget-body").empty().append(a),(l=r.children("header")).append(function(){function e(){var e=_("#zy_tabs").closest(".row").children(":last");_("#jarviswidget-fullscreen-mode").length,function(o,e){o.html(C);var t=o.find(".close_uploadfile_dialog"),p=o.find("form"),c=(o.find("#resulttree"),o.find(".file_list")),h=o.find(".start_update"),a=o.find(".upload_target_path"),u=o.find(".log"),f=o.find(".progress-txt"),m=o.find(".progress").html(),g=o.find(".progressc"),n=_.fn.zTree.getZTreeObj("maintree").getSelectedNodes();function i(){var e=z._label("input").attr("type","file").attr("name","file").attr("multiple","true");return c.append(e),e}function v(e){return e<1024?e.toFixed(2)+"B":e<1048576?(e/1024).toFixed(2)+"K":e<1073741824?(e/1048576).toFixed(2)+"M":(e/1073741824).toFixed(2)+"G"}n[0]&&(n[0].isParent?a.val(n[0].path):a.val(n[0].getParentNode().path)),h.click(function(){var d=a.val();if(d&&_("input[type=file]").val()){var s=_("input[type=file]").val().toLowerCase(),e=s.split(".").length;s.split(".")[e-1],b(d,function(e){var t=e,a=_.isArray(t)?t:t.children,n=!1;if(_.each(a,function(e,t){var a=t.name.toLowerCase();if(s==a)return!(n=!0)}),n)y.ui.msg("提示信息","存在","e");else{f.html("&nbsp;");var i=o.find(".file-state").empty();try{c.find("input").each(function(){for(var e=0;e<this.files.length;++e){var t=this.files[e];i.append(["<div style='display:flex'>",'<div style="flex:1">',t.name,"</div><div>",v(t.size),"</div>"].join(""));var a=t.name.substr(t.name.lastIndexOf("."));if(!w[a])throw new Error("该文件的类型("+a+")不被服务器接受: "+t.name)}})}catch(e){return y.ui.msg("错误",e,"e")}h.attr("disabled",!0).text("正在上传...");var l=_(m);g.removeClass("hide").find(".progress").empty().append(l),z._formPost("uploadfile",p,function(e){var t;h.removeAttr("disabled").text("开始上传"),t=e,u.removeClass("hide").addClass(t.code?"alert-warning":"alert-info"),u.find(".content").prepend(['<p><small style="color:#aaa;">[',(new Date).toLocaleString(),"]</small><br/>",t.msg,"</p>"].join("")),0===e.code&&b(d,function(e){var t=_.fn.zTree.getZTreeObj("maintree"),a=t.getNodesByParam("path",d)[0],n=e;_.isArray(n)?a.children=n:a.children=n.children,a.open=!0,t.refresh()})},r)}function r(e){var t=Math.floor(e.loaded/e.total*100)+"%";l.css("width",t),f.empty().append("<div style='flex:1'>"+t+"<div>").append("<div>"+v(e.loaded)+" / "+v(e.total)+"<div>")}})}else y.ui.msg("提示信息","文件路径及文件不可为空","w")}),t.click(function(){o.hide(),o.parent().children(":eq(1)").trigger("size")}),o.find(".add_file").click(function(){i().click()}),o.find(".reset_file_list").click(function(){c.empty(),i()})}(e),e.show(),_("#zy_tabs").parent().trigger("size")}function t(){var t,e,a,n=_("#zy_tabs").closest(".row").children(":last");_("#jarviswidget-fullscreen-mode").length,n.attr("style","right:10px"),(t=n).empty(),e=z._label("div").addClass("input-group input-group-sm").attr("style","width:100%;margin-bottom:-15px"),(a=z._label("header")).append(z._label("label").html("查看历史")).append(z._label("label").attr("name","historyname")).append(z._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(z._label("i").addClass("fa fa-times"))),t.append(e.append(a)),t.append(z._label("legend")),a.children("a").unbind(),a.children("a").click(function(){var e=_(this).closest(".col-sm-3");e.hide(),e.parent().children(":eq(1)").trigger("size")}),t.append(z._label("div").addClass("row").attr("style","margin-top:-10px;overflow:auto;height:100%").attr("name","result")),function(){var e=_("pre:visible").parent().attr("name");if(o())var a="$/t/paas"+e;else var a="$/t/saas/"+y.g.comm.org+e;var n=_("pre:visible").attr("name"),i=_("pre:visible").attr("id");null==e?t.find("[name=result]").append(_("<center>").append("没有目标文件")):z._apis("hist",function(e){e&&(t.find("[name=historyname]").html("("+n+")"),t.find("[name=result]").append(e),t.find("[name=result]").find("h3").empty(),t.find("[name=result]").find("a").each(function(e,t){_(t).attr("href","javascript:void(0);"),_(t).unbind().bind("click",function(){$a=_(this);var r,d,e,s,o,t=$a.siblings("b").text();r=a,d=$a,e=t,s=n,o=i,z._apis("cont",function(e){var t=_("#widget-grid").find("header .glyphicon-saved").parent(),a=s+" "+d.html(),n=o+d.html(),i=B.add(a,r,n);i.inputc.val("");var l=s.split(".")[1];j(function(){t.hide(),$.set(e.data,!1),$.initSize()},i.pre,l)},{f:r,d:d.html(),i:e,js:1})})})),0==t.find("ul").children().length&&t.find("[name=result]").append(_("<center>").append("空"))},{f:a})}(),n.show(),_("#zy_tabs").parent().trigger("size")}function a(){var e=_("#zy_tabs").closest(".row").children(":last"),t=!1;0<_("#jarviswidget-fullscreen-mode").length&&(t=!0),function(e,t){var a,n;e.empty(),a=z._label("div").addClass("input-group input-group-sm").attr("style","width:100%;margin-bottom:-15px"),(n=z._label("header")).append(z._label("label").html("按文件内容查询")).append(z._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(z._label("i").addClass("fa fa-times"))),e.append(a.append(n)),e.append(z._label("legend")),n.children("a").unbind(),n.children("a").click(function(){var e=_(this).closest(".col-sm-3");e.hide(),e.parent().children(":eq(1)").trigger("size")});var i=z._label("ul").addClass("ztree").attr("id","resulttree").attr("name","resulttree"),l=z._label("div").addClass("smart-form").attr("style","margin-top:-10px");e.append(l),e.append(z._label("legend"));var r=z._label("textarea ").attr("placeholder","内容").attr("rows","3"),d=(z._label("_label").addClass("glyphicon glyphicon-search").attr("rel","tooltip").attr("title","查询"),z._label("button").addClass("btn btn-default btn-xs pull-right").attr("style","margin-top:5px;margin-right:14px").html("查询")),s=z._label("i").addClass("fa fa-times pull-right").attr("style","margin-right:13px"),o=z._label("label").addClass("toggle state-error pull-left").attr("style","margin:4px 0 0 5px");o.append(z._label("input").attr("type","checkbox").attr("checked",1)).append(z._label("i").attr({"data-swchoff-text":"off","data-swchon-text":"on",title:"区分大小写"})),e.append(z._label("div").addClass("row").attr("style","margin-top:-10px;display:none").append(z._label("h").attr("style","margin-left:20px").html("查询结果")).append(s));var p,c,h,u="overflow:auto;display:none;height:";t&&(u="overflow:auto;display:none;height:"),u+=x-400+"px",e.append(z._label("div").addClass("row").attr("style",u).append(i)),l.append(z._label("label").addClass("textarea").append(r)),l.append(z._label("div").addClass("row").attr("style","margin-bottom:-10px").append(o).append(d)),(h=s).unbind(),h.click(function(){var e=_(this).closest("div");e.hide(),e.next().hide(),e.prev().hide()}),p=d,c=o.children("input"),(p||c)&&(p.unbind(),p.click(function(){var e=c.prop("checked"),t={content:r.val(),casesensitive:e};z._api("search",function(e){Boolean(e.ret)?y.ui.msg("提示","接口执行失败:"+e.msg,"e"):(i.siblings().remove(),i.empty(),0===e.result.children.length?i.parent().append(z._label("div").css({"text-align":"center","vertical-align":"middle"}).html("空")):k({tree:{ztree:i},mod:f},e.result),i.parent().siblings(":hidden").show(),i.parent().show())},_.extend(!0,t,y.g.comm))}))}(e,t),e.show(),_("#zy_tabs").parent().trigger("size")}function n(){var e=_("#zy_tabs").closest(".row").children(":last"),t=!1;0<_("#jarviswidget-fullscreen-mode").length&&(t=!0),function(e,t){var a,n;e.empty(),a=z._label("div").addClass("input-group input-group-sm").attr("style","width:100%;margin-bottom:-15px"),(n=z._label("header")).append(z._label("label").html("按文件名查询")).append(z._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(z._label("i").addClass("fa fa-times"))),e.append(a.append(n)),e.append(z._label("legend")),n.children("a").unbind(),n.children("a").click(function(){var e=_(this).closest(".col-sm-3");e.hide(),e.parent().children(":eq(1)").trigger("size")});var i=z._label("ul").addClass("ztree").attr("id","resulttree").attr("name","resulttree"),l=z._label("div").addClass("input-group input-group-sm").attr("style","margin:-10px 0-5px");e.append(l),e.append(z._label("legend")),l.append(z._label("span").addClass("input-group-addon"));var r=z._label("input").addClass("form-control").attr("placeholder","查询").attr("type","text"),d=z._label("_label").addClass("glyphicon glyphicon-search").attr("rel","tooltip").attr("title","查询"),s=z._label("button").addClass("btn btn-default").html("查询"),o=z._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(z._label("i").addClass("fa fa-times")).attr("style","margin-right:13px");e.append(z._label("div").addClass("row").attr("style","margin-top:-10px;display:none").append(z._label("h").attr("style","margin-left:20px").html("查询结果")).append(o));var p,c,h="overflow:auto;display:none; height:";t&&(h="overflow:auto;display:none; height:"),h+=x-300+"px",e.append(z._label("div").addClass("row").attr("style",h).append(i)),l.append(z._label("div").addClass("icon-addon addon-sm").append(r).append(d)),l.append(z._label("span").addClass("input-group-btn").append(s)),(c=o).unbind(),c.click(function(){var e=_(this).closest("div");e.hide(),e.next().hide(),e.prev().hide()}),(p=s)&&(p.unbind(),p.click(function(){var e={};e.content=r.val(),z._api("search",function(e){Boolean(e.ret)?y.ui.msg("提示","接口执行失败:"+e.msg,"e"):(i.siblings().remove(),i.empty(),0===e.result.children.length?i.parent().append(z._label("div").css({"text-align":"center","vertical-align":"middle"}).html("空")):k({tree:{ztree:i},mod:f},e.result),i.parent().siblings(":hidden").show(),i.parent().show())},_.extend(!0,e,y.g.comm))}))}(e,t),e.show(),_("#zy_tabs").parent().trigger("size")}var i,l,r=z._label("div").attr("role","menu").addClass("widget-toolbar").attr("title","功能表"),d=z._label("i").addClass("fa fa-align-justify dropdown-toggle").attr("data-toggle","dropdown"),s=z._label("ul").addClass("dropdown-menu pull-right");return r.append(z._label("div").addClass("btn-group").append(d).append(s)),i=[{id:"byid",name:"按文件名称查找"},{id:"bycontent",name:"按文件内容查找"},{id:"fileinput",name:"上传文件"},{id:"history",name:"查看历史"}],l=s,_.each(i,function(e,t){var a=z._label("li").append(z._label("a").html(t.name)).attr("id",t.id);l.append(a)}),s.children().unbind(),s.children().click(function(){"byid"===_(this).attr("id")&&n(),"bycontent"===_(this).attr("id")&&a(),"fileinput"===_(this).attr("id")&&e(),"history"===_(this).attr("id")&&t()}),r}()),l.append((d=z._label("div").attr("role","menu").addClass("widget-toolbar").attr("style","display:none;").attr("title","保存"),(s=z._label("i").addClass("glyphicon glyphicon-saved")).unbind(),s.click(function(){f.empty();var e=_("#zy_tabs").children("div:visible").find("pre").attr("id"),t=_("#zy_tabs").children("div:visible").find("div").attr("name"),a=ace.edit(e);if(v(a),_("#left-panel nav").bind("click",function(){a.destroy(),a.container.remove()}),a&&t){_(this).btnDisable(!0);var n={path:t,content:a.getValue().trim(),reason:""};y.g.am.app="ZYAPP_IDE",y.g.am.mod="uiidemod",y.net.get("api/save_remove",function(e){"0"==e.ret&&z._post("savefile",function(e){_(this).btnDisable(!1),y.ui.msg("保存文件",e.msg,0!=parseInt(e.ret)?"e":"s"),_(".modal").modal("hide")},_.extend(!0,n,y.g.comm))},null)}}),d.append(s))),l.append(function(){var e=z._label("div").attr("role","menu").addClass("widget-toolbar").attr("style","display:none;").attr("title","更改状态");e.append(z._label("div").addClass("btn-group"));var t=z._label("i").addClass("glyphicon glyphicon-cloud-upload dropdown-toggle").attr("data-toggle","dropdown"),a=z._label("ul").addClass("dropdown-menu pull-right");return e.unbind("show"),e.bind("show",function(e,t){}),e.children().append(t).append(a).parent()}()),l.append((p=z._label("div").attr("role","menu").addClass("widget-toolbar").attr("title","文件目录"),(c=z._label("i").addClass("glyphicon glyphicon-folder-open")).unbind(),c.click(function(){g.container.is(":visible")?(_(this).children().removeClass().addClass("glyphicon glyphicon-chevron-right"),g.container.hide()):(_(this).children().removeClass().addClass("glyphicon glyphicon-chevron-left"),g.container.show()),_("#zy_tabs").parent().trigger("size")}),p.append(c))),l.append((h=z._label("div").attr("role","menu").addClass("widget-toolbar").attr("style","display:none;").attr("title","预览"),(u=z._label("i").addClass("glyphicon glyphicon-play")).unbind(),u.click(function(){var e,t=_("#zy_tabs").children("div:visible").find("div").attr("name").replace(/^\//,"");y.cache.get("_zy_user_info","ls").get("user_selected_org_path"),y.isXBosonSystem?e=t.startsWith("web/")?y.g.host.ui+"/"+t:y.g.host.ui+"/t/"+(o()?"paas":"saas/"+y.g.comm.org)+"/emptymain.html#"+t:(e="http://"+location.host+"/t/",e+=o()?"paas":"saas/"+y.g.comm.org,e+="/emptymain.html#"+t),y.log("window.open  _u == "+e),window.open(e,"")}),h.append(u))),{wid:r,tree:{ztree:g.ul,container:g.container,sResultCon:g.sResult},pre:n,mod:f,result:t}}("ide"),B=function(i){function c(e){e.click(function(){var e=_("#widget-grid").find("header .glyphicon-cloud-upload").closest(".widget-toolbar"),t=i.wid.children("header").find(".glyphicon-saved").parent(),a=i.wid.children("header").find(".glyphicon-play").parent(),n=i.wid.children("header").find(".glyphicon-sort").parent();1==h.getCount()&&(f(!1),e.hide(),t.hide(),a.hide(),n.hide())})}function e(){var a=_("#widget-grid").find("header .glyphicon-play").parent();a.unbind("visible"),a.bind("visible",function(e,t){m[t]?a.show():a.hide()});var n=_("#widget-grid").find("header .glyphicon-saved").parent();n.unbind("historyvisible"),n.bind("historyvisible",function(e,t){1==t.length?n.show():n.hide()}),h.el.on("tabsbeforeactivate",function(e,t){var a=t.newPanel.children().children(),n=_("#widget-grid").find("header .glyphicon-cloud-upload").closest(".widget-toolbar"),i=_("#widget-grid").find("header .glyphicon-saved").parent(),l=a.attr("name").split(".")[1];_("#widget-grid").find("header .glyphicon-play").parent().trigger("visible",[l]);var r=a.children().attr("name").split(" ");i.trigger("historyvisible",[r]),a.attr("name")?n.trigger("show",[a.attr("stability")]):(i.hide(),n.hide())})}var t=i.pre,h=new zyTabs(t);return e(),{add:function(e,t,a,n,i){f(!0);var l=z._label("input").addClass("form-control").attr("readonly","readonly");if(/^(png)|(jpg)|(jpeg)|(gif)|(ico)/.test(n)){var r=z._image("img");r.attr("src",i).css("z-index",9999).css("max-height","380px").css("max-width","380px");var d=z._label("pre");d.attr("style","background-color:white;border:0").attr("id",a).attr("name",e).addClass("fix_size");var s=z._label("div").addClass("row").css("height",x-u).append(d.append(r)).addClass("fix_size")}else{var o=z._label("pre");o.attr("style","font-family:Consolas,Microsoft YaHei,微软雅黑,sans-serif,宋体;top:-14;height:100%; width:100%;").attr("id",a).attr("name",e).addClass("fix_size"),s=z._label("div").addClass("row").css("height",x-u).append(o).addClass("fix_size")}t&&s.attr("name",t);var p=h.AddTab(a,e,!0,s);return p?(h.active(p),{pre:h.el.find("[aria-hidden=false]").find("pre"),inputc:l}):(c(h.el.find("li[aria-selected=true]").find(".hover-transparent:has(i)")),{pre:o,inputc:l})},eventOn:e,delbtn:c}}(e);!function(){var e=navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),a="iphone os"==e.match(/iphone os/i),n="midp"==e.match(/midp/i),i="rv:1.2.3.4"==e.match(/rv:1.2.3.4/i),l="ucweb"==e.match(/ucweb/i),r="android"==e.match(/android/i),d="windows ce"==e.match(/windows ce/i),s="windows mobile"==e.match(/windows mobile/i);if(t||a||n||i||l||r||d||s){var o=window.screen.height;_("article").attr("style","overflow: auto;height:"+o+"px;"),_(window).resize(function(){_("article").attr("style","overflow: auto;height:"+o+"px;")})}}(),k(e),pageSetUp(),s=e,_("#left-panel a[href]").one("click",function(){window.onbeforeunload=null,_(window).unbind("resize")}),s.tree.container,_("#zy_tabs").parent(),s.wid.find(".jarviswidget-fullscreen-btn").click(function(){var e;if(s.result.find("div:has(ul)"),_("#zy_tabs").find("div.row:has(pre)"),_("#zy_tabs").find("p").children(),0!=_("pre").length)var t=_("#zy_tabs").children("div:visible").find("pre"),a=_("#zy_tabs").children("div:visible").find("pre").attr("id"),n=_("#zy_tabs").children("div:visible").find("pre").attr("name"),i=n.split(".").length,l=n.split(".")[i-1];_("pre"),e=0<_("#jarviswidget-fullscreen-mode").length?(/^(png)|(jpg)|(jpeg)|(gif)|(ico)/.test(l)?_("img").each(function(e,t){}):0!=_("pre").length&&($=ace.edit(a),_("#left-panel nav").bind("click",function(){$.destroy(),$.container.remove()}),$.setOption("wrap",120),$.setOption("tabSize",2),v($),d(t,l)),(e=_(_(".col-xs-12.col-sm-3")[0]).children(":last").attr("style")).replace(/552/,"440")):(/^(png)|(jpg)|(jpeg)|(gif)|(ico)/.test(l)?_("img").each(function(e,t){}):0!=_("pre").length&&($=ace.edit(a),_("#left-panel nav").bind("click",function(){$.destroy(),$.container.remove()}),$.setOption("wrap",120),$.setOption("tabSize",2),v($),d(t,l)),(e=_(_(".col-xs-12.col-sm-3")[0]).children(":last").attr("style")).replace(/440/,"552")),_(_(".col-xs-12.col-sm-3")[0]).children(":last").attr("style",e)})}(jQuery,zy);