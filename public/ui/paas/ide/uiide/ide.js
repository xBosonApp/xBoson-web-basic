!function(y,w){var C,r,f={"":1,html:1,htm:1,md:1},n="lib/js/ace/1.4.2/ace.js",x=y("#uploadfile_html_template").html(),z=0,p={edit:[{name:"名称",id:"filenm",type:"input",write:!0,width:6},{name:"类型",id:"type",type:"input",write:!0,width:6}]};function v(e){w.setEditorExOptions(e)}r=w.isXBosonSystem?function(e){return w.g.host.api+"app/"+w.g.comm.org+"/ZYAPP_IDE/ZYMODULE_UI_IDE/"+e}:function(e){return"http://"+location.host+"/api/"+_apinm},w.net.get("app/a297dfacd7a84eab9656675f61750078/ZYAPP_IDE/ZYMODULE_UI_IDE/file_ext_allow",function(e){C=e.data||{},z=e.max_post_body||0});var b,u=220;function t(){var e,t=y("#ide"),a=y(window).resize(i).scroll(function(){n=a.scrollTop(),t.css("margin-top",n)}),n=0;function i(){b=a.height(),e=b-u,y("#maintree").css("height",e),y(".fix_size").css("height",e)}y.ready(i),i(),i}t();var k={_api:function(e,t,a,n){a||(a={});var i=a.cb="callback"+w.tool.random();y.ajax({url:r(e),dataType:"jsonp",data:w.fix_jsonp_parm(a),type:n||"GET",jsonpCallback:i,success:function(e){w.fix_xboson_data(e),e.ret=e.code,t(e)},error:function(e,t,a){w.log("Error: "+a.message)}})},_apis:function(e,t,a,n){y.ajax({url:r(e),data:a||{},type:n||"GET",success:function(e){w.fix_xboson_data(e),t(e)},error:function(e,t,a){w.log("Error: "+a.message)}})},_formPost:function(e,t,i,a,n){var l=r(e)+"?onweb=1&path="+encodeURIComponent(n)+"&"+w.net.parseParam(w.g.comm);t.ajaxSubmit({url:l,type:"post",async:!0,timeout:15e3,cache:!1,dataType:"json",success:function(e){w.fix_xboson_data(e),i&&i(e)},error:function(e,t,a){var n=a.message||t;"error"!=n&&""!=n||(n="服务器关闭了连接"),i&&i({code:1,msg:n})},xhr:function(){var e=y.ajaxSettings.xhr();return a&&e.upload&&e.upload.addEventListener("progress",a),e}})},_post:function(e,t,a){y.post(r(e),a,function(e){w.fix_xboson_data(e),e.ret=e.code,t&&t(e)})},_label:function(e){return y("<"+e+"></"+e+">")},_image:function(e){return y("<"+e+"/>")},_arrToObj:function(e,t){if(t){var a={};y.each(e,function(e,t){a[t]=!0})}else{a=[];y.each(e,function(e,t){a.push(t)})}return a}};function m(e){window.onbeforeunload=e?function(){return parent.$("body").removeClass("animated fadeOutUp"),"请确认代码已提交"}:null,y(window).unbind("resize"),t()}function d(e,t){var a=y("#widget-grid").find("header .glyphicon-saved");var n=e.attr("id"),i=ace.edit(n);return y("#left-panel nav").bind("click",function(){i.container.remove()}),i.setTheme("ace/theme/ambiance"),t&&"htm"!=t?i.getSession().setMode("ace/mode/"+t):i.getSession().setMode("ace/mode/html"),i.$blockScrolling=1/0,v(i),i.commands.addCommand({name:"myCommand",bindKey:{win:"Ctrl+S",mac:"Command+S"},exec:function(e){a&&a.trigger("click")}}),{get:function(){return i.getValue().trim()},set:function(e,t,a){""==i.getValue().trim()?(setTimeout(function(){i.getSession().getUndoManager().reset()},1),i.setValue(e+"\n\n\n\n\n"),i.navigateFileStart(),i.setReadOnly(t)):w.ui.msg(a||"","文件已经在IDE中打开","i")},initSize:function(){i.setShowPrintMargin(!1),i.setFontSize(13.5),i.setHighlightSelectedWord(!0),i.setOption("wrap",120),i.setOption("tabSize",2)}}}function j(e,t){e.wid;var a=e.tree.ztree,d=e.mod;function h(e,t,a){var n=y.fn.zTree.getZTreeObj("maintree"),i=y.fn.zTree.getZTreeObj("resulttree"),l=n&&n.getNodeByParam("path",e.path,null),r=i&&i.getNodeByParam("path",e.path,null);if("e"===t&&(l&&(y.extend(!0,l,a),n.updateNode(l),n.refresh()),r&&(y.extend(!0,r,a),i.updateNode(r))),"a"===t&&(l&&n.addNodes(l,a),r&&i.addNodes(r,a)),"r"===t){if(l){var d=l.getParentNode();n.removeNode(l),d.isParent=!0,n.updateNode(d)}if(r){var s=r.getParentNode();i.removeNode(r),0===s.level&&0===s.children.length&&(i.destroy(),y("#resulttree").parent().append(k._label("div").css({"text-align":"center","vertical-align":"middle"}).html("空"))),s.isParent=!0,i.updateNode(s)}}}var u=null;function s(p,c,e){var n=p;e&&y.each(c,function(e,t){var a=n.find("[name="+e+"]");0<a.length&&(a.hasClass("select2-offscreen")?a.select2("val",t.replace(/(.0)$/g,"")):a.val(t.replace(/(.0)$/g,"")))});var t=n.find("[name=ide_submit]");t.unbind(),t.click(function(){var i,e=y(".modal-body").find("[type=input]").val(),t=y("input[name=type]:checked").val();if("文件夹"===t)i=e.toLowerCase(),t=null;else{var a=[e,t].join(".");i=a.toLowerCase()}var n=e.length;if(l=!0,p.children().find("input").each(function(e,t){if(y(t).attr("name")&&"updatedt"!==y(t).attr("name")&&"createdt"!==y(t).attr("name")&&""===y(t).val()&&"type"!=y(t).attr("name"))return w.ui.msg("提示",y(t).attr("placeholder")+"不可为空","w"),l=!1}),l){var l,r,d="修改文件名"===y(this).closest(".modal-content").find("h4").text(),s=y.extend(!0,{},{path:c.path},(r={},p.find("input").each(function(e,t){var a=y("input[name=type]:checked").val();"文件夹"===a?(y(t).attr("role")||(r[y(t).attr("name")]=y(t).val()),"type"===y(t).attr("name")&&(r.type=!1)):([y(t).val(),a].join("."),y(t).attr("role")||(r[y(t).attr("name")]=y(t).val()),"type"===y(t).attr("name")&&(r.type=!0))}),r),w.g.comm);if(s.ext_name=t,/(^[\u4e00-\u9fa5a-zA-Z0-9_\-\.]+$)/.test(e))if(d)if(60<n)w.ui.msg("提示信息","名称必须在60个字以内","w");else{var o=c.getParentNode();m(o.path,function(e){var t=e;y.isArray(t)?o.children=t:o.children=t.children;var n=!1;y.each(o.children,function(e,t){var a=t.name.toLowerCase();if(i==a)return!(n=!0)}),n?w.ui.msg("提示信息","存在","e"):k._api("rename",function(e){Boolean(e.ret)?w.ui.msg("提示信息","接口执行失败:"+e.msg,"e"):(h(c,"e",e.result),w.ui.msg("提示信息","修改成功"+e.msg,"s"),y(".modal").modal("hide"),e.result||m(o.path,function(e){var t=e;y.isArray(t)?o.children=t:o.children=t.children,o.open=!0,u.updateNode(o),u.refresh()},!1))},s)},!1)}else 60<n?w.ui.msg("提示信息","名称必须在60个字以内","w"):m(c.path,function(e){var t=e;y.isArray(t)?c.children=t:c.children=t.children;var n=!1;y.each(c.children,function(e,t){var a=t.name.toLowerCase();if(i==a)return!(n=!0)}),n?w.ui.msg("提示信息","存在","e"):k._api("mkfile",function(e){Boolean(e.ret)?w.ui.msg("提示信息","接口执行失败:"+e.msg,"e"):m(c.path,function(e){var t=e;y.isArray(t)?c.children=t:c.children=t.children,c.open=!0,u.updateNode(c),u.refresh(),w.ui.msg("提示信息","新增成功","s"),y(".modal").modal("hide")},!1)},s)},!1);else w.ui.msg("提示信息","不准输入除中文、字母、数字以外的特殊字符","w")}})}function o(n){var i=n.name,e=i.split(".").length,l=n.name.split(".")[e-1];/^(png)$|^(jpg)$|^(jpeg)$|^(gif)$|^(ico)$|^(htm)$|^(html)$|^(js)$|^(css)$|^(woff2)$|^(woff)$|^(ttf)$|^(svg)$|^(eot)$|^(zip)$|^(rar)$|^(psd)$|^(ai)$|^(mp4)$|^(m4v)$|^(pdf)$|^(txt)$|^(md)$|^(swf)$|^(doc)$|^(ppt)$|^(xls)$/.test(l)?_lastname=l:_lastname="文件夹",w.net.loadHTML("ide/uiide/ide_edit.html",d,function(){if(n.isParent)n.name;else{var e=l.length,t=i.length-(e+1);n.name.substr(0,t)}var a={filenm:n.name};y(".modal-title").html("修改文件名"),y(".modal-body").empty(),d._form(y(".modal-body"),p.edit,a),y(".modal").modal("show"),function(e){e.empty();var t,a,n=k._label("div").addClass("inline-group");n.append((t=_lastname,(a=k._label("label").addClass("radio")).html(t).append(k._label("input").attr({type:"radio",name:"type",checked:!0,value:_lastname})).append(k._label("i")),a)),e.append(n)}(y(".modal-body").find("[name=type]").parent()),s(d.find("form"),n,!0)})}function m(e,a,t){var n={};y.extend(!0,n,w.g.comm),n.path=e,k._api("getfilelist",function(e){if(Boolean(e.ret))w.ui.msg("提示","接口执行失败:"+e.msg,"e");else{var t=e.result;y.isArray(t)?t=i(t):t.children=i(t.children),a&&a(t)}},n)}function i(e){var a=[],n=[];return y.each(e,function(e,t){t.isParent?n.push(t):a.push(t)}),[].concat(n,a)}var n={view:{showTitle:!0,selectedMulti:!1,showIcon:!0,dblClickExpand:!1},data:{key:{name:"name",title:"path"},simpleData:{enable:!1},keep:{parent:!0}},edit:{drag:{isCopy:!1,isMove:!1},showRenameBtn:!1,showRemoveBtn:!1,enable:!0}};n.callback={onExpand:function(e,t,a){a.children&&0!==a.children.length||m(a.path,function(e){var t=e;a.children=t,u.refresh()},!1)},onClick:function(e,a,n){if(n.isParent&&y("#zy_tabs").closest(".row").children(":last").find("[type=text]").val(n.path),!n.isParent){var t={path:n.path,orgid:w.g.comm.org},i=e.target;if(!y(i).attr("title")){if(!n)return;var l,r=y("#widget-grid").find("header .glyphicon-saved").parent(),d=y("#widget-grid").find("header .glyphicon-play").parent(),s=n.name,o=s.split(".").length,p=s.split(".")[o-1];if(a=(s+n.path).replace(/\//g,"").replace(/\./g,""),/^(png)|(jpg)|(jpeg)|(gif)|(ico)/.test(p))l=w.isXBosonSystem?w.g.host.ui:"/web/zr",_path=l+n.path,P.add(s,n.path,a,p,_path).inputc.val("");else k._api("getcontent",function(e){if(Boolean(e.ret))w.ui.msg("提示","接口执行失败:"+e.msg,"e");else{var t=P.add(s,n.path,a);t.inputc.val(""),S(function(){$.set(e.result.content,!1,n.path),$.initSize(),r.show()},t.pre,e.result.filetype),f[e.result.filetype]?d.show():d.hide()}},y.extend(!0,t,w.g.comm))}}}},n.view.addHoverDom=function(e,a){var t=y("#"+a.tId+"_span");if(!(a.editNameFlag||0<y("#addBtn_"+a.tId).length||0<y("#editBtn_"+a.tId).length||0<y("#remBtn_"+a.tId).length)){var n="<span class='button add' id='addBtn_"+a.tId+"' title='添加' onfocus='this.blur();'></span>",i="<span class='button edit' id='editBtn_"+a.tId+"' title='修改' onfocus='this.blur();'></span>",l="<span class='button remove' id='remBtn_"+a.tId+"' title='删除' onfocus='this.blur();'></span>",r=a.tId;/maintree/.test(r)&&0!==a.level&&t.after(l).after(i),a.isParent&&t.after(n),0===a.level&&-1<a.tId.indexOf("resulttree")&&y("#addBtn_"+a.tId).unbind().remove(),y("#remBtn_"+a.tId).bind("click",function(){var e;e=a.isParent?"删除文件夹会删除其中包含的文件，确认要删除":"确认要删除",w.ui.mask("请确认",e+a.name+"?",function(){var t={};t.path=a.path,w.g.am.app="ZYAPP_IDE",w.g.am.mod="uiidemod",w.net.get("api/save_remove",function(e){"0"==e.ret&&k._api("remove",function(e){return Boolean(e.ret)?w.ui.msg("提示信息","接口执行失败,"+e.msg,"e"):(h(a,"r"),w.ui.msg("提示信息",e.msg,"s"))},y.extend(!0,t,w.g.comm))},null)})}),y("#addBtn_"+a.tId).bind("click",function(){return u.selectNode(a),function(e){w.net.loadHTML.call(this,"ide/uiide/ide_edit.html",d,function(){y(".modal-title").html("创建新文件"),y(".modal").modal("show"),s(d.find("form"),e,!1)})}(a),!1}),y("#editBtn_"+a.tId).bind("click",function(){return u.selectNode(a),o(a),!1})}},n.view.removeHoverDom=function(e,t){y("#addBtn_"+t.tId).unbind().remove(),y("#editBtn_"+t.tId).unbind().remove(),y("#remBtn_"+t.tId).unbind().remove()},a.empty(),t?u=y.fn.zTree.init(a,n,t):m("/",function(e){u=y.fn.zTree.init(a,n,e)})}function S(e,t,a){w.net.loadScript.call(this,n,function(){$=d(t,a),e&&e()})}var $,s,e=function(e){function _(e,a,t){var n={};y.extend(!0,n,w.g.comm),n.path=e,k._api("getfilelist",function(e){if(Boolean(e.ret))w.ui.msg("提示","接口执行失败:"+e.msg,"e");else{var t=e.result;y.isArray(t)?t=i(t):t.children=i(t.children),a&&a(t)}},n)}function i(e){var a=[],n=[];return y.each(e,function(e,t){t.isParent?n.push(t):a.push(t)}),[].concat(n,a)}function o(){var a=!0,e=w.cache.get("_zy_user_info","ls"),n=w.g.comm.org,t=e.get("user_org_list");return y.each(t,function(e,t){t.orgid==n&&(a=t.isplatorg)}),a}function t(){var e,t,a,n,i=r.find(".jarviswidget-editbox"),l=k._label("div").addClass("row");l.append((e=function(t){$&&$.contentid&&(t.btnDisable(!0),k._api({apiid:"ucode",r_param:{contentid:$.contentid,content:$.get(),updatecmt:""}},function(e){Boolean(e.ret)?w.ui.msg("提示","接口执行失败:"+e.msg,"e"):(t.btnDisable(!1),w.ui.msg("提示信息","文件保存成功","s"))}))},t=k._label("a").addClass("btn btn-labeled btn-success pull-right").attr("href","javascript:void(0);").css("margin-right","17px"),a=k._label("span").addClass("btn-label"),n=k._label("i").addClass("glyphicon glyphicon-ok"),t.append(a.append(n)).append("提交"),t.click(function(){e&&e(y(this))}),t)),i.append(l)}var r=y("#"+e),m=k._label("div");m._form=function(e,t,a){var n,i,l,r,d=y.extend(!0,{},t),s=(n=d,i=[],l=[],r=[],y.each(n,function(e,t){12===t.width?l.push(t):"createdt"===t.id||"updatedt"===t.id?r.push(t):i.push(t)}),{half:i,full:l,time:r});function o(e){if(12!==e.width)var t=k._label("section").addClass("col col-"+e.width);else t=k._label("section");var a=k._label("label").addClass("label").html(e.name);if("textarea"===e.type)var n=k._label("label").addClass("textarea has-warning"),i=k._label("textarea").attr("name",e.id).attr("placeholder",e.name);else n=k._label("label").addClass("input has-warning"),i=k._label("input").attr("name",e.id).attr("type",e.type).attr("placeholder",e.name);"select2"===i.attr("type")&&i.attr("type","input"),e.write||i.attr("readonly","readonly");var l=k._label("b").addClass("tooltip tooltip-bottom-right").html(e.name+"为必填项");return n.append(i).append(l),t.append(a).append(n),t}function p(e){var t=e/2;return Math.round(t)===t}var c=k._label("form").attr("onsubmit","return false;").addClass("smart-form");c.append(y("<fieldset></fieldset>")),y.each(s.half,function(e,t){var a=e/2;if(p(e)){var n=k._label("div").addClass("row");c.children().append(n)}else a-=.5;c.find("div").eq(a).append(o(t))});var h,u,m,f,g,v=null;y.each(s.time,function(e,t){p(e)&&(v=k._label("div").addClass("row")),v.append(o(t)),c.children().append(v)}),y.each(s.full,function(e,t){c.children().append(o(t))}),h=c,u=k._label("footer"),m=k._label("button").addClass("btn btn-default").attr("data-dismiss","modal").html("取消"),f=k._label("button").addClass("btn btn-primary").attr("name","ide_submit").html("确定"),u.append(m).append(f),h.append(u),g=d,y.each(g,function(e,t){"status"===t.id&&w.cache.initDicts("ZR.0001",function(){c.find("[name="+t.id+"]").zySelect("ZR.0001",!1,{allowClear:!1,width:"100%"}),c.find("[name="+t.id+"]").select2("val","1")}),"auflag"===t.id&&w.cache.initDicts("ZR.0029",function(){c.find("[name="+t.id+"]").zySelect("ZR.0029",!1,{allowClear:!1,width:"100%"}),c.find("[name="+t.id+"]").select2("val","0")}),"optype"===t.id&&w.cache.initDicts("ZR.0010",function(){c.find("[name="+t.id+"]").zySelect("ZR.0010",!1,{allowClear:!1,width:"100%"}),c.find("[name="+t.id+"]").select2("val","0")})}),e.append(c),a&&y.each(a,function(e,t){c.find("[name="+e+"]").val(t)})};var a=k._label("div").addClass("row"),n=k._label("div").addClass("col-xs-12 col-sm-9").css({});n.unbind(),n.bind("size",function(e){y(this).removeClass();var t=y(this).siblings(":visible");if(0<t.length){var a=0;y.each(t,function(e,t){a+=Number(y(t).attr("class").replace(/col-xs-12 col-sm-/g,""))}),y(this).addClass("col-xs-12 col-sm-"+(12-a))}else y(this).addClass("col-xs-12 col-sm-12")});var l,d,s,p,c,h,u,f=k._label("pre").attr("id","zy_ide_editor"),t=k._label("div").addClass("col-xs-12 col-sm-3").css({display:"none"}),g=function(){var e,t,a,n=k._label("div").addClass("col-xs-12 col-sm-3");e=n,t=k._label("div").addClass("input-group input-group-sm").attr("style","width:100%;margin-bottom:-15px"),(a=k._label("header")).append(k._label("label").html("文件目录")).append(k._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(k._label("i").addClass("fa fa-times"))),e.append(t.append(a)),e.append(k._label("legend")),a.children("a").unbind(),a.children("a").click(function(){var e=y(this).closest(".col-sm-3");e.hide(),e.parent().children(":eq(1)").trigger("size")});var i=k._label("ul").addClass("ztree").attr("id","maintree");return n.append(k._label("div").attr("style","overflow: auto; height: 100%;").addClass("row").css("margin-top","-15px").append(i)),{container:n,ul:i}}();return r.closest("#widget-grid").after(m),f.attr("style","font-family:Consolas,PingFang SC,Source Han Sans SC Light,Microsoft YaHei,Arial,Sans-Serif;top:-14;height:100%; width:100%;"),a.append(g.container).append(n).append(t),r.find(".widget-body").empty().append(a),(l=r.children("header")).append(function(){function e(){var e=y("#zy_tabs").closest(".row").children(":last");y("#jarviswidget-fullscreen-mode").length,function(p,e){p.html(x);var t=p.find(".close_uploadfile_dialog"),c=p.find("form"),h=(p.find("#resulttree"),p.find(".file_list")),u=p.find(".start_update"),a=p.find(".upload_target_path"),m=p.find(".log"),f=p.find(".progress-txt"),g=p.find(".progress").html(),v=p.find(".progressc"),n=y.fn.zTree.getZTreeObj("maintree").getSelectedNodes();function i(){var e=k._label("input").attr("type","file").attr("name","file").attr("multiple","true");return h.append(e),e}function b(e){return e<1024?e.toFixed(2)+"B":e<1048576?(e/1024).toFixed(2)+"K":e<1073741824?(e/1048576).toFixed(2)+"M":(e/1073741824).toFixed(2)+"G"}n[0]&&(n[0].isParent?a.val(n[0].path):a.val(n[0].getParentNode().path)),u.click(function(){var s=a.val();if(s&&y("input[type=file]").val()){var o=y("input[type=file]").val().toLowerCase(),e=o.split(".").length;o.split(".")[e-1],_(s,function(e){var t=e,a=y.isArray(t)?t:t.children,n=!1;if(y.each(a,function(e,t){var a=t.name.toLowerCase();if(o==a)return!(n=!0)}),n)w.ui.msg("提示信息","存在","e");else{f.html("&nbsp;");var i=p.find(".file-state").empty(),l=0;try{h.find("input").each(function(){for(var e=0;e<this.files.length;++e){var t=this.files[e];l+=t.size,i.append(["<div style='display:flex'>",'<div style="flex:1">',t.name,"</div><div>",b(t.size),"</div>"].join(""));var a=t.name.substr(t.name.lastIndexOf("."));if(!C[a])throw new Error("该文件的类型("+a+")不被服务器接受: "+t.name)}})}catch(e){return w.ui.msg("错误",e,"e")}if(0<z&&z<l)return w.ui.msg("错误","超过服务器上传文件尺寸上限 "+b(z),"e");u.attr("disabled",!0).text("正在上传...");var r=y(g);v.removeClass("hide").find(".progress").empty().append(r),w.g.comm.unzip=y("#unzip").prop("checked"),k._formPost("uploadfile",c,function(e){var t;u.removeAttr("disabled").text("开始上传"),t=e,m.removeClass("hide").addClass(t.code?"alert-warning":"alert-info"),m.find(".content").prepend(['<p><small style="color:#aaa;">[',(new Date).toLocaleString(),"]</small><br/>",t.msg,"</p>"].join("")),0===e.code&&_(s,function(e){var t=y.fn.zTree.getZTreeObj("maintree"),a=t.getNodesByParam("path",s)[0],n=e;y.isArray(n)?a.children=n:a.children=n.children,a.open=!0,t.refresh()})},d,s)}function d(e){var t=Math.floor(e.loaded/e.total*100)+"%";r.css("width",t),f.empty().append("<div style='flex:1'>"+t+"<div>").append("<div>"+b(e.loaded)+" / "+b(e.total)+"<div>")}})}else w.ui.msg("提示信息","文件路径及文件不可为空","w")}),t.click(function(){p.hide(),p.parent().children(":eq(1)").trigger("size")}),p.find(".add_file").click(function(){i().click()}),p.find(".reset_file_list").click(function(){h.empty(),i()})}(e),e.show(),y("#zy_tabs").parent().trigger("size")}function t(){var t,e,a,n=y("#zy_tabs").closest(".row").children(":last");y("#jarviswidget-fullscreen-mode").length,n.attr("style","right:10px"),(t=n).empty(),e=k._label("div").addClass("input-group input-group-sm").attr("style","width:100%;margin-bottom:-15px"),(a=k._label("header")).append(k._label("label").html("查看历史")).append(k._label("label").attr("name","historyname")).append(k._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(k._label("i").addClass("fa fa-times"))),t.append(e.append(a)),t.append(k._label("legend")),a.children("a").unbind(),a.children("a").click(function(){var e=y(this).closest(".col-sm-3");e.hide(),e.parent().children(":eq(1)").trigger("size")}),t.append(k._label("div").addClass("row").attr("style","margin-top:-10px;overflow:auto;height:100%").attr("name","result")),function(){var e=y("pre:visible").parent().attr("name");if(o())var a="$/t/paas"+e;else var a="$/t/saas/"+w.g.comm.org+e;var n=y("pre:visible").attr("name"),i=y("pre:visible").attr("id");null==e?t.find("[name=result]").append(y("<center>").append("没有目标文件")):k._apis("hist",function(e){e&&(t.find("[name=historyname]").html("("+n+")"),t.find("[name=result]").append(e),t.find("[name=result]").find("h3").empty(),t.find("[name=result]").find("a").each(function(e,t){y(t).attr("href","javascript:void(0);"),y(t).unbind().bind("click",function(){$a=y(this);var r,d,e,s,o,t=$a.siblings("b").text();r=a,d=$a,e=t,s=n,o=i,k._apis("cont",function(e){var t=y("#widget-grid").find("header .glyphicon-saved").parent(),a=s+" "+d.html(),n=o+d.html(),i=P.add(a,r,n);i.inputc.val("");var l=s.split(".")[1];S(function(){t.hide(),$.set(e.data,!1),$.initSize()},i.pre,l)},{f:r,d:d.html(),i:e,js:1})})})),0==t.find("ul").children().length&&t.find("[name=result]").append(y("<center>").append("空"))},{f:a})}(),n.show(),y("#zy_tabs").parent().trigger("size")}function a(){var e=y("#zy_tabs").closest(".row").children(":last"),t=!1;0<y("#jarviswidget-fullscreen-mode").length&&(t=!0),function(e,t){var a,n;e.empty(),a=k._label("div").addClass("input-group input-group-sm").attr("style","width:100%;margin-bottom:-15px"),(n=k._label("header")).append(k._label("label").html("按文件内容查询")).append(k._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(k._label("i").addClass("fa fa-times"))),e.append(a.append(n)),e.append(k._label("legend")),n.children("a").unbind(),n.children("a").click(function(){var e=y(this).closest(".col-sm-3");e.hide(),e.parent().children(":eq(1)").trigger("size")});var i=k._label("ul").addClass("ztree").attr("id","resulttree").attr("name","resulttree"),l=k._label("div").addClass("smart-form").attr("style","margin-top:-10px");e.append(l),e.append(k._label("legend"));var r=k._label("textarea ").attr("placeholder","内容").attr("rows","3"),d=(k._label("_label").addClass("glyphicon glyphicon-search").attr("rel","tooltip").attr("title","查询"),k._label("button").addClass("btn btn-default btn-xs pull-right").attr("style","margin-top:5px;margin-right:14px").html("查询")),s=k._label("i").addClass("fa fa-times pull-right").attr("style","margin-right:13px"),o=k._label("label").addClass("toggle state-error pull-left").attr("style","margin:4px 0 0 5px");o.append(k._label("input").attr("type","checkbox").attr("checked",1)).append(k._label("i").attr({"data-swchoff-text":"off","data-swchon-text":"on",title:"区分大小写"})),e.append(k._label("div").addClass("row").attr("style","margin-top:-10px;display:none").append(k._label("h").attr("style","margin-left:20px").html("查询结果")).append(s));var p,c,h,u="overflow:auto;display:none;height:";t&&(u="overflow:auto;display:none;height:"),u+=b-400+"px",e.append(k._label("div").addClass("row").attr("style",u).append(i)),l.append(k._label("label").addClass("textarea").append(r)),l.append(k._label("div").addClass("row").attr("style","margin-bottom:-10px").append(o).append(d)),(h=s).unbind(),h.click(function(){var e=y(this).closest("div");e.hide(),e.next().hide(),e.prev().hide()}),p=d,c=o.children("input"),(p||c)&&(p.unbind(),p.click(function(){var e=c.prop("checked"),t={content:r.val(),casesensitive:e};k._api("search",function(e){Boolean(e.ret)?w.ui.msg("提示","接口执行失败:"+e.msg,"e"):(i.siblings().remove(),i.empty(),0===e.result.children.length?i.parent().append(k._label("div").css({"text-align":"center","vertical-align":"middle"}).html("空")):j({tree:{ztree:i},mod:m},e.result),i.parent().siblings(":hidden").show(),i.parent().show())},y.extend(!0,t,w.g.comm))}))}(e,t),e.show(),y("#zy_tabs").parent().trigger("size")}function n(){var e=y("#zy_tabs").closest(".row").children(":last"),t=!1;0<y("#jarviswidget-fullscreen-mode").length&&(t=!0),function(e,t){var a,n;e.empty(),a=k._label("div").addClass("input-group input-group-sm").attr("style","width:100%;margin-bottom:-15px"),(n=k._label("header")).append(k._label("label").html("按文件名查询")).append(k._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(k._label("i").addClass("fa fa-times"))),e.append(a.append(n)),e.append(k._label("legend")),n.children("a").unbind(),n.children("a").click(function(){var e=y(this).closest(".col-sm-3");e.hide(),e.parent().children(":eq(1)").trigger("size")});var i=k._label("ul").addClass("ztree").attr("id","resulttree").attr("name","resulttree"),l=k._label("div").addClass("input-group input-group-sm").attr("style","margin:-10px 0-5px");e.append(l),e.append(k._label("legend")),l.append(k._label("span").addClass("input-group-addon"));var r=k._label("input").addClass("form-control").attr("placeholder","查询").attr("type","text"),d=k._label("_label").addClass("glyphicon glyphicon-search").attr("rel","tooltip").attr("title","查询"),s=k._label("button").addClass("btn btn-default").html("查询"),o=k._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(k._label("i").addClass("fa fa-times")).attr("style","margin-right:13px");e.append(k._label("div").addClass("row").attr("style","margin-top:-10px;display:none").append(k._label("h").attr("style","margin-left:20px").html("查询结果")).append(o));var p,c,h="overflow:auto;display:none; height:";t&&(h="overflow:auto;display:none; height:"),h+=b-300+"px",e.append(k._label("div").addClass("row").attr("style",h).append(i)),l.append(k._label("div").addClass("icon-addon addon-sm").append(r).append(d)),l.append(k._label("span").addClass("input-group-btn").append(s)),(c=o).unbind(),c.click(function(){var e=y(this).closest("div");e.hide(),e.next().hide(),e.prev().hide()}),(p=s)&&(p.unbind(),p.click(function(){var e={};e.content=r.val(),k._api("search",function(e){Boolean(e.ret)?w.ui.msg("提示","接口执行失败:"+e.msg,"e"):(i.siblings().remove(),i.empty(),0===e.result.children.length?i.parent().append(k._label("div").css({"text-align":"center","vertical-align":"middle"}).html("空")):j({tree:{ztree:i},mod:m},e.result),i.parent().siblings(":hidden").show(),i.parent().show())},y.extend(!0,e,w.g.comm))}))}(e,t),e.show(),y("#zy_tabs").parent().trigger("size")}var i,l,r=k._label("div").attr("role","menu").addClass("widget-toolbar").attr("title","功能表"),d=k._label("i").addClass("fa fa-align-justify dropdown-toggle").attr("data-toggle","dropdown"),s=k._label("ul").addClass("dropdown-menu pull-right");return r.append(k._label("div").addClass("btn-group").append(d).append(s)),i=[{id:"byid",name:"按文件名称查找"},{id:"bycontent",name:"按文件内容查找"},{id:"fileinput",name:"上传文件"},{id:"history",name:"查看历史"}],l=s,y.each(i,function(e,t){var a=k._label("li").append(k._label("a").html(t.name)).attr("id",t.id);l.append(a)}),s.children().unbind(),s.children().click(function(){"byid"===y(this).attr("id")&&n(),"bycontent"===y(this).attr("id")&&a(),"fileinput"===y(this).attr("id")&&e(),"history"===y(this).attr("id")&&t()}),r}()),l.append((d=k._label("div").attr("role","menu").addClass("widget-toolbar").attr("style","display:none;").attr("title","保存"),(s=k._label("i").addClass("glyphicon glyphicon-saved")).unbind(),s.click(function(){m.empty();var e=y("#zy_tabs").children("div:visible").find("pre").attr("id"),t=y("#zy_tabs").children("div:visible").find("div").attr("name"),a=ace.edit(e);if(v(a),y("#left-panel nav").bind("click",function(){a.destroy(),a.container.remove()}),a&&t){y(this).btnDisable(!0);var n={path:t,content:a.getValue().trim(),reason:""};w.g.am.app="ZYAPP_IDE",w.g.am.mod="uiidemod",w.net.get("api/save_remove",function(e){"0"==e.ret&&k._post("savefile",function(e){y(this).btnDisable(!1),w.ui.msg("保存文件",e.msg,0!=parseInt(e.ret)?"e":"s"),y(".modal").modal("hide")},y.extend(!0,n,w.g.comm))},null)}}),d.append(s))),l.append(function(){var e=k._label("div").attr("role","menu").addClass("widget-toolbar").attr("style","display:none;").attr("title","更改状态");e.append(k._label("div").addClass("btn-group"));var t=k._label("i").addClass("glyphicon glyphicon-cloud-upload dropdown-toggle").attr("data-toggle","dropdown"),a=k._label("ul").addClass("dropdown-menu pull-right");return e.unbind("show"),e.bind("show",function(e,t){}),e.children().append(t).append(a).parent()}()),l.append((p=k._label("div").attr("role","menu").addClass("widget-toolbar").attr("title","文件目录"),(c=k._label("i").addClass("glyphicon glyphicon-folder-open")).unbind(),c.click(function(){g.container.is(":visible")?(y(this).children().removeClass().addClass("glyphicon glyphicon-chevron-right"),g.container.hide()):(y(this).children().removeClass().addClass("glyphicon glyphicon-chevron-left"),g.container.show()),y("#zy_tabs").parent().trigger("size")}),p.append(c))),l.append((h=k._label("div").attr("role","menu").addClass("widget-toolbar").attr("style","display:none;").attr("title","预览"),(u=k._label("i").addClass("glyphicon glyphicon-play")).unbind(),u.click(function(){var e,t=y("#zy_tabs").children("div:visible").find("div").attr("name").replace(/^\//,"");w.cache.get("_zy_user_info","ls").get("user_selected_org_path"),w.isXBosonSystem?e=t.startsWith("web/")?w.g.host.ui+"/"+t:w.g.host.ui+"/t/"+(o()?"paas":"saas/"+w.g.comm.org)+"/emptymain.html#"+t:(e="http://"+location.host+"/t/",e+=o()?"paas":"saas/"+w.g.comm.org,e+="/emptymain.html#"+t),w.log("window.open  _u == "+e),window.open(e,"")}),h.append(u))),{wid:r,tree:{ztree:g.ul,container:g.container,sResultCon:g.sResult},pre:n,mod:m,result:t}}("ide"),P=function(i){function c(e){e.click(function(){var e=y("#widget-grid").find("header .glyphicon-cloud-upload").closest(".widget-toolbar"),t=i.wid.children("header").find(".glyphicon-saved").parent(),a=i.wid.children("header").find(".glyphicon-play").parent(),n=i.wid.children("header").find(".glyphicon-sort").parent();1==h.getCount()&&(m(!1),e.hide(),t.hide(),a.hide(),n.hide())})}function e(){var a=y("#widget-grid").find("header .glyphicon-play").parent();a.unbind("visible"),a.bind("visible",function(e,t){f[t]?a.show():a.hide()});var n=y("#widget-grid").find("header .glyphicon-saved").parent();n.unbind("historyvisible"),n.bind("historyvisible",function(e,t){1==t.length?n.show():n.hide()}),h.el.on("tabsbeforeactivate",function(e,t){var a=t.newPanel.children().children(),n=y("#widget-grid").find("header .glyphicon-cloud-upload").closest(".widget-toolbar"),i=y("#widget-grid").find("header .glyphicon-saved").parent(),l=a.attr("name").split(".")[1];y("#widget-grid").find("header .glyphicon-play").parent().trigger("visible",[l]);var r=a.children().attr("name").split(" ");i.trigger("historyvisible",[r]),a.attr("name")?n.trigger("show",[a.attr("stability")]):(i.hide(),n.hide())})}var t=i.pre,h=new zyTabs(t);return e(),{add:function(e,t,a,n,i){m(!0);var l=k._label("input").addClass("form-control").attr("readonly","readonly");if(/^(png)|(jpg)|(jpeg)|(gif)|(ico)/.test(n)){var r=k._image("img");r.attr("src",i).css("z-index",9999).css("max-height","380px").css("max-width","380px");var d=k._label("pre");d.attr("style","background-color:white;border:0").attr("id",a).attr("name",e).addClass("fix_size");var s=k._label("div").addClass("row").css("height",b-u).append(d.append(r)).addClass("fix_size")}else{var o=k._label("pre");o.attr("style","font-family:Consolas,PingFang SC,Source Han Sans SC Light,Microsoft YaHei,Arial,Sans-Serif;top:-14;height:100%; width:100%;").attr("id",a).attr("name",e).addClass("fix_size"),s=k._label("div").addClass("row").css("height",b-u).append(o).addClass("fix_size")}t&&s.attr("name",t);var p=h.AddTab(a,e,!0,s);return p?(h.active(p),{pre:h.el.find("[aria-hidden=false]").find("pre"),inputc:l}):(c(h.el.find("li[aria-selected=true]").find(".hover-transparent:has(i)")),{pre:o,inputc:l})},eventOn:e,delbtn:c}}(e);!function(){var e=navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),a="iphone os"==e.match(/iphone os/i),n="midp"==e.match(/midp/i),i="rv:1.2.3.4"==e.match(/rv:1.2.3.4/i),l="ucweb"==e.match(/ucweb/i),r="android"==e.match(/android/i),d="windows ce"==e.match(/windows ce/i),s="windows mobile"==e.match(/windows mobile/i);if(t||a||n||i||l||r||d||s){var o=window.screen.height;y("article").attr("style","overflow: auto;height:"+o+"px;"),y(window).resize(function(){y("article").attr("style","overflow: auto;height:"+o+"px;")})}}(),j(e),pageSetUp(),s=e,y("#left-panel a[href]").one("click",function(){window.onbeforeunload=null,y(window).unbind("resize")}),s.tree.container,y("#zy_tabs").parent(),s.wid.find(".jarviswidget-fullscreen-btn").click(function(){var e;if(s.result.find("div:has(ul)"),y("#zy_tabs").find("div.row:has(pre)"),y("#zy_tabs").find("p").children(),0!=y("pre").length)var t=y("#zy_tabs").children("div:visible").find("pre"),a=y("#zy_tabs").children("div:visible").find("pre").attr("id"),n=y("#zy_tabs").children("div:visible").find("pre").attr("name"),i=n.split(".").length,l=n.split(".")[i-1];y("pre"),e=0<y("#jarviswidget-fullscreen-mode").length?(/^(png)|(jpg)|(jpeg)|(gif)|(ico)/.test(l)?y("img").each(function(e,t){}):0!=y("pre").length&&($=ace.edit(a),y("#left-panel nav").bind("click",function(){$.destroy(),$.container.remove()}),$.setOption("wrap",120),$.setOption("tabSize",2),v($),d(t,l)),(e=y(y(".col-xs-12.col-sm-3")[0]).children(":last").attr("style")).replace(/552/,"440")):(/^(png)|(jpg)|(jpeg)|(gif)|(ico)/.test(l)?y("img").each(function(e,t){}):0!=y("pre").length&&($=ace.edit(a),y("#left-panel nav").bind("click",function(){$.destroy(),$.container.remove()}),$.setOption("wrap",120),$.setOption("tabSize",2),v($),d(t,l)),(e=y(y(".col-xs-12.col-sm-3")[0]).children(":last").attr("style")).replace(/440/,"552")),y(y(".col-xs-12.col-sm-3")[0]).children(":last").attr("style",e)})}(jQuery,zy);