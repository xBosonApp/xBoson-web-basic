function RunApi(e,a){function i(e){function a(a){var i=$("<section>").addClass("col-sm-3").attr("style","margin-left: 10px"),n=$("<label>").addClass("input").html("参数名称"),t=$(' <a href="form-x-editable.html#"  class="editable editable-click" name="key" data-type="text" data-pk="1" data-placement="right" data-placeholder="Required"></a> ');return i.append(n).append(t),t.html(e.key),v.trigger("_param"),t.editable({validate:function(e){return""==$.trim(e)?"This field is required":void 0},display:function(e){$(this).html(e),v.trigger("_param")}}),a.append(i),t}function i(a){var i=$("<section>").addClass("col-sm-3").attr("style","margin-left: 10px"),n=$("<label>").addClass("input").html("值"),t=$(' <a href="form-x-editable.html#"  class="editable editable-click" name="value" data-type="text" data-pk="1" data-placement="right" data-placeholder="Required"></a> ');return i.append(n).append(t),t.html(e.value),v.trigger("_param"),t.editable({validate:function(e){return""==$.trim(e)?"This field is required":void 0},display:function(e){$(this).html(e),v.trigger("_param")}}),a.append(i),t}function n(){var e=l.key.html(),a=l.value.html();return[e,encodeURIComponent(a)]}var e=e||{key:"",desc:"",value:""},t=s(),r='<h4><i name="removekey" class="fa fa-fw fa-times-circle txt-color-red" style="display:none"></i></h4>',d=$("<div>").addClass("row").attr("_index",t);u.find("#api_assist_2").append(d);var l={key:a(d),value:i(d)};b[t]=n,zy.log(l),d.append(r),d.mouseover(function(){$($(this).find("[name=removekey]")).attr("style","cursor:pointer"),d.find("i").click(function(){v.trigger("_param");var e=$(this).closest("div"),a=e.attr("_index");delete b[a],e.remove()})}),d.mouseout(function(){$("[name=removekey]").attr("style","display:none")})}function n(e){e.param.length>0&&$.each(e.param,function(e,a){i(a)})}function t(){var a="api",i=location.host,n="/ds/",t="01",d="";g.change(function(e){a=e.val,v.trigger("_change")}),y.change(function(e){t=e.val,v.trigger("_change")}),v.bind("_change",function(e){var r=$(this),l=u.find("[name=fullurl]"),o=$.extend({},zy.g.comm,{app:c,mod:f,s:"d",ems:"ems"});delete o.orgtype,delete o.orgpath;var p="";if("01"==t){var s="&";""!=d?"&"==d[d.length-1]&&(s=""):s="",p=i+n+a+"/"+h+"?"+d+s+zy.net.parseParam(o)}else p=i+n+a+"/"+h+"?"+zy.net.parseParam(o);r.val(d),l.val(p),setTimeout(function(){$("[name=fullurl]").trigger("input")},300)}),v.bind("_param",function(e){var a=[];$.each(b,function(e,i){var n=i();a.push(n.join("="))}),d=a.join("&"),$(this).trigger("_change")}),u.find("[name=runApi]").click(function(e){var a="http://"+u.find("[name=fullurl]").val();zy.log("url=",a);var i={};"01"!=t&&$.each(b,function(e,a){var n=a();i[n[0]]=n[1]}),zy.log("common=",i),m(a,i,t)}),u.find("[name=switch]").click(function(e){u.find("#jsoneditor").is(":hidden")?(u.find("#jsoneditor").show(),u.find("#jsonformatter").hide()):(u.find("#jsoneditor").hide(),u.find("#jsonformatter").show())}),u.find("[name=runSubmit]").click(function(a){var i={_api:function(e,a,i){if(e.apiid){var n=$.extend(!0,{},e.r_param),t=function(e){e?a&&a(e):i&&i(e)};zy.g.am.mod="zymodule_ide",zy.g.am.app="zyapp_ide";var r="ide/";zy.net.post(r+e.apiid,t,n)}}},n={},t={appid:c,moduleid:f,apiid:h};zy.g.am.app="ZYAPP_IDE",zy.g.am.mod="ZYMODULE_IDE",zy.net.get("api/getapiinfo",function(a){var t=a.result[0],d=$("#ide_run [name=value]"),l=[];if($("#ide_run [name=key]").each(function(e,a){l[e]={},l[e].key=$(a).html(),l[e].value=d.eq(e).html(),""==t.help_info||e>=JSON.parse(t.help_info).param.length?l[e].desc="Empty":l[e].desc=JSON.parse(t.help_info).param[e].desc}),n.apiid=r(e,!0),n.r_param={type:1,appid:e.appid,moduleid:e.moduleid,apiid:e.apiid,apinm:t.apinm,status:t.status},-1!==t.help_info.indexOf('"param":['))n.r_param.help_info=t.help_info.slice(0,t.help_info.indexOf('"param":['))+'"param":'+JSON.stringify(l)+t.help_info.slice(t.help_info.indexOf(',"result":{'));else if(l.length){var o={api_classify:$("#ide_run").find("[name=apitype]").val(),requests:$("#ide_run").find("[name=ajaxtype]").val(),param:l};n.r_param.help_info=JSON.stringify(o)}else n.r_param.help_info="";zy.log($(".ui-draggable").data("roleid")),n.r_param.roleid=$(".ui-draggable").data("roleid"),i._api(n,function(e){zy.ui.msg("提示信息","成功","s")})},t,null,function(e){zy.log(e)})})}function r(e,a){return e.appid?e.moduleid?e.apiid&&e.contentid?"api":e.moduleid&&!e.apiid?a?"mod":"api":e.apiid&&e.hisid?"his":void 0:a?"app":"mod":"app"}function d(e){zy.cache.initDicts("ZR.0052,ZR.0053",function(){g.zySelect("ZR.0053",!1,{width:"100%",allowClear:!1}),g.select2("val","api"),y.zySelect("ZR.0052",!1,{width:"100%",allowClear:!1}),y.select2("val","01"),e&&e()})}function l(){loadScript("lib/js/plugin/x-editable/jquery.mockjax.min.js",o)}function o(){loadScript("lib/js/plugin/x-editable/x-editable-new.min-n.js",p)}function p(){loadScript("lib/js/plugin/typeahead/typeahead.bundle.min.js",function(){d(function(){u.find("[name=addkey]").click(function(){i()}),""!=a&&(_=JSON.parse(a),n(_)),t(),u.modal("show"),v.trigger("_change"),v.trigger("_param")})})}function s(){return Math.round(1e6*Math.random())}function m(e,a,i){function n(e){window.ee=e,j.set(JSON.parse(e)),k.set(JSON.parse(e))}"01"==i&&$.get(e,a,function(e){n(e)}),"02"==i&&$.post(e,a,function(e){n(e)})}var u=$("#ide_run"),c=e.appid,f=e.moduleid,h=e.apiid,g=u.find("[name=apitype]"),y=u.find("[name=ajaxtype]"),v=u.find("[name=url]"),_=null,b={},j=new jsoneditor.JSONEditor(u.find("#jsoneditor").get(0),{mode:"viewer",change:function(){app.lastChanged=j}}),k=new jsoneditor.JSONFormatter(u.find("#jsonformatter").get(0),{});window.ee=j,loadScript("lib/js/plugin/x-editable/moment.min.js",l)}