function NewIDE(w){var _,s,C=105,d=220+C,n=80,a="lib/js/ace/1.4.2/ace.js",c={app:{add:[{name:"应用ID",id:"appid",type:"input",write:!0,width:6},{name:"应用名称",type:"input",id:"appnm",write:!0,width:6},{name:"应用状态",type:"select2",id:"status",write:!0,width:6},{name:"应用说明",type:"textarea",id:"about",write:!0,width:12}],edit:[{name:"应用ID",id:"appid",type:"input",write:!1,width:6},{name:"应用名称",type:"input",write:!0,id:"appnm",width:6},{name:"应用状态",type:"select2",id:"status",write:!0,width:6},{name:"创建时间",type:"input",id:"createdt",write:!1,width:6},{name:"修改时间",type:"input",id:"updatedt",write:!1,width:6},{name:"应用说明",type:"textarea",id:"about",write:!0,width:12}]},mod:{add:[{name:"业务ID",id:"moduleid",type:"input",write:!0,width:6},{name:"业务名称",type:"input",id:"modulenm",write:!0,width:6},{name:"业务分类",id:"auflag",type:"select2",write:!0,width:6},{name:"业务状态",id:"status",type:"select2",write:!0,width:6},{name:"业务说明",type:"textarea",id:"about",write:!0,width:12}],edit:[{name:"业务ID",type:"input",id:"moduleid",write:!1,width:6},{name:"业务名称",type:"input",id:"modulenm",write:!0,width:6},{name:"业务分类",type:"select2",id:"auflag",write:!0,width:6},{name:"业务状态",type:"select2",id:"status",write:!0,width:6},{name:"创建时间",type:"input",id:"createdt",write:!1,width:6},{name:"修改时间",type:"input",id:"updatedt",write:!1,width:6},{name:"业务说明",type:"textarea",id:"about",write:!0,width:12}]},api:{add:[{name:"API ID",id:"apiid",type:"input",write:!0,width:6},{name:"API 名称",id:"apinm",type:"input",write:!0,width:6},{name:"API 状态",type:"select2",id:"status",write:!0,width:6}],edit:[{name:"API ID",type:"input",id:"apiid",write:!1,width:6},{name:"API 名称",type:"input",id:"apinm",write:!0,width:6},{name:"API 状态",id:"status",type:"select2",write:!0,width:6},{name:"创建时间",id:"createdt",type:"input",write:!1,width:6},{name:"修改时间",id:"updatedt",type:"input",write:!1,width:6}]}};function l(){var e,t=$("#api_ide_content"),a=$(window).resize(n).scroll(function(){i=a.scrollTop(),t.css("margin-top",i)}),i=0;function n(){_=a.height(),e=_-d,$("#maintree").css("height",e),$(".fix_size").css("height",e+C)}$.ready(n),n(),s=n}l();var x={_api:function(e,t,a){if(e.apiid){var i=$.extend(!0,{},e.r_param);zy.g.am.mod=e.modid||"zymodule_ide",zy.g.am.app=e.appid||"zyapp_ide";var n=e.apitype||"ide/";zy.net.post(n+e.apiid,function(e){e?t&&t(e):a&&a(e)},i)}},_label:function(e){return $("<"+e+"></"+e+">")},_arrToObj:function(e,t){if(t){var a={};$.each(e,function(e,t){a[t]=!0})}else{a=[];$.each(e,function(e,t){a.push(t)})}return a}},e="\n[递交到 "+location.origin+"]",z=x._label("textarea").attr("placeholder","修改原因").val(e);var I={};function u(e){e?window.onbeforeunload=function(){return parent.$("body").removeClass("animated fadeOutUp"),"请确认代码已提交"}:(window.onbeforeunload=null,$(window).unbind("resize"),l())}function r(e){var t=$("#widget-grid").find("header .glyphicon-saved");var a=e.attr("id"),i=ace.edit(a);return $("#left-panel nav").bind("click",function(){i.destroy(),i.container.remove()}),i.setTheme("ace/theme/ambiance"),i.getSession().setMode("ace/mode/sjs"),i.$blockScrolling=1/0,zy.setEditorExOptions(i,"api"),i.commands.addCommand({name:"myCommand",bindKey:{win:"Ctrl+S",mac:"Command+S"},exec:function(e){t&&t.trigger("click")}}),{initSize:function(){i.setShowPrintMargin(!1),i.setFontSize(13.5),i.setHighlightSelectedWord(!0),i.setOption("wrap",n),i.setOption("tabSize",2),i.resize()},get:function(){return i.getValue().trim()},set:function(e,t,a){console.log(new Error),""==i.getValue().trim()?(setTimeout(function(){i.getSession().getUndoManager().reset()},1),i.setValue(e+"\n\n\n\n\n"),i.navigateFileStart(),i.setReadOnly(t)):zy.ui.msg(a||"","文件已经在IDE中打开","i")}}}function k(e,t){e.wid;var a=e.tree.ztree,d=e.mod;function r(e,t){return e.appid?e.moduleid?e.apiid&&e.contentid?"api":e.moduleid&&!e.apiid?t?"mod":"api":e.apiid&&e.hisid?"his":void 0:t?"app":"mod":"app"}var l=null;function p(l,o,e){var i=l;if(e){var t={appid:o.appid,moduleid:o.moduleid,apiid:o.apiid};zy.g.am.app="ZYAPP_IDE",zy.g.am.mod="ZYMODULE_IDE",zy.net.get("api/getapiinfo",function(e){$.each(e.result[0],function(e,t){var a=i.find("[name="+e+"]");0<a.length&&(a.hasClass("select2-offscreen")?a.select2("val",t):a.val(t.replace(/\.0/g,"")))})},t,null,function(e){})}var a=i.find("[name=ide_submit]");a.unbind(),a.click(function(){if(i=!0,l.children().find("input").each(function(e,t){var a=$(t).attr("name");a&&"updatedt"!==a&&"createdt"!==a&&""===a?(zy.ui.msg("提示",$(t).attr("placeholder")+"不可为空","w"),i=!1):a&&"apiid"===a&&($(t).val().match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)||(zy.ui.msg("提示",'apiid请以字母或下划线"_"开始！',"w"),i=!1))}),i){var i,e,a,t,p="修改"===$(this).closest(".modal-content").find("h4").text()?1:0,n={},d={type:p};o.appid&&(d.appid=o.appid),o.moduleid&&(d.moduleid=o.moduleid),n.apiid=r(o,Boolean(p)),n.r_param=$.extend(!0,{},d,(a={},t=(e=l).find("textarea"),e.find("input").each(function(e,t){$(t).attr("role")||(a[$(t).attr("name")]=$(t).val())}),delete a.createdt,delete a.updatedt,a[t.attr("name")]=t.val(),a)),n.r_param.roleid=w,x._api(n,function(e){var t,a,i,n,d,l,r;t=o,a=Boolean(p),i=e.result[0],n=$.fn.zTree.getZTreeObj("maintree"),d=$.fn.zTree.getZTreeObj("resulttree"),l=n&&n.getNodeByParam("someid",t.someid,null),r=d&&d.getNodeByParam("someid",t.someid,null),a?(l&&($.extend(!0,l,i),n.updateNode(l)),r&&($.extend(!0,r,i),d.updateNode(r))):l&&n.addNodes(l,i),zy.ui.msg("提示信息","成功","s"),$(".modal").modal("hide")})}})}function n(e,i,t){var n=!0;void 0!==t&&(n=t),x._api({apiid:"apis",r_param:{roleid:w,id:e}},function(e){var t,a=e;a.value&&(n&&(t=a.value,$.each(t,function(e,t){t.isParent=!0})),i&&i(a.value),s())})}function o(e,t){var a={apiid:zy.fix_api_name("scode")};a.r_param=e,x._api(a,function(e){t&&t(e.content[0])})}var i={view:{showTitle:!0,selectedMulti:!1,showIcon:!0,dblClickExpand:!1},data:{key:{name:"appnm",title:"showid"},simpleData:{enable:!1}},edit:{drag:{isCopy:!1,isMove:!1},showRenameBtn:!1,showRemoveBtn:!1,enable:!0}};i.callback={onExpand:function(e,t,a){var i=!a.contentid;a.children||n(a.someid,function(e){var t=e;a.contentid&&$.each(t,function(e,t){t.appnm=t.appnm.replace(/(.0)$/g,"")}),a.children=t,l.refresh()},i)},onClick:function(e,t,i){if(i){var n=$("#widget-grid").find("header .glyphicon-cloud-upload").closest(".widget-toolbar"),d=$("#widget-grid").find("header .glyphicon-saved").parent(),l=$("#widget-grid").find("header .glyphicon-calendar").parent(),r=$("#widget-grid").find("header .glyphicon-play");i.hisid&&o({hisid:i.hisid},function(e){var t=i.hisid+i.apiid+i.moduleid+i.appid,a=m.add(i.apiid+"-"+i.appnm.replace(/[\(（][^\)）]+[\)）]/g,""),i.hisid,e.stability,t);a.inputc.val(e.updatecmt),h(function(){D.set(e.content,!0),D.initSize(),d.hide(),l.hide(),r.parent().hide(),n.hide()},a.pre)}),i.contentid&&o({contentid:i.contentid},function(e){try{var t=i.apiid+"--"+i.moduleid+"--"+i.appid,a=m.add(i.apiid,i.contentid,e.stability,t);a.inputc.val(e.updatecmt),a.pre.attr("help_info",e.help_info),h(function(){n.trigger("show",[e.stability]),D.initSize(),D.set(e.content,!1,i.apiid),d.show(),l.show(),r.parent().show(),r.trigger("_init",[i,e.help_info])},a.pre)}catch(e){throw console.log("ide/htmlide/ide.js",e),zy.ui.msg("IDE 打开错误","ID 使用了中文可能出错, 检查 app/module/api 的 id 是否正确.","e"),e}})}},onDblClick:function(e,t,a,i){}},i.view.addHoverDom=function(e,i){var t=$("#"+i.tId+"_span");if(!(i.editNameFlag||0<$("#addBtn_"+i.tId).length||0<$("#editBtn_"+i.tId).length)){var a="<span class='button add' id='addBtn_"+i.tId+"' title='添加' onfocus='this.blur();'></span>",n="<span class='button edit' id='editBtn_"+i.tId+"' title='修改' onfocus='this.blur();'></span>";i.moduleid&&!i.apiid&&t.after(a),i.contentid&&t.after(n),$("#addBtn_"+i.tId).bind("click",function(){var a;return l.selectNode(i),a=i,zy.net.loadHTML("ide/htmlide/ide_edit.html",d,function(){var e=r(a,!1);$(".modal-title").html("新增"),$("#ide_edit .modal-body").empty(),d._form($("#ide_edit .modal-body"),c[e].add),$("#ide_edit").modal("show"),p(d.find("form"),a,!1);var t=$("<textarea>").attr("style","display:none").attr("name","help_info");d.find("fieldset").append(t)}),!1}),$("#editBtn_"+i.tId).bind("click",function(){var t;return l.selectNode(i),t=i,zy.net.loadHTML("ide/htmlide/ide_edit.html",d,function(){var e=r(t,!0);$(".modal-title").html("修改"),$("#ide_edit .modal-body").empty(),d._form($("#ide_edit .modal-body"),c[e].edit),$("#ide_edit").modal("show"),p(d.find("form"),t,!0),"api"==e&&api_help.button(d.find("fieldset"),$("#modal_container3"),$(d.find("textarea")[0]),t)}),!1})}},i.view.removeHoverDom=function(e,t){$("#addBtn_"+t.tId).unbind().remove(),$("#editBtn_"+t.tId).unbind().remove()},a.empty(),t?l=$.fn.zTree.init(a,i,t):n("",function(e){if(0!=e.length){var t=[];t[0]={appnm:"xBoson IDE",children:e,open:!0,showid:"xBoson IDE"},l=$.fn.zTree.init(a,i,t)}0==e.length&&a.after($('<div style="text-align: center; vertical-align: middle;">空</div>'))})}function h(e,t){zy.net.loadScript.call(this,a,function(){D=r(t),e&&e()})}var D,p,t=function(e){function t(){var e,t,a,i,n=l.find(".jarviswidget-editbox"),d=x._label("div").addClass("row");d.append((e=function(t){D&&D.contentid&&(t.btnDisable(!0),x._api({apiid:zy.fix_api_name("ucode"),r_param:{contentid:D.contentid,content:D.get(),updatecmt:""}},function(e){e&&(t.btnDisable(!1),zy.ui.msg("提示信息",e.msg||"API保存成功","s"))}))},t=x._label("a").addClass("btn btn-labeled btn-success pull-right").attr("href","javascript:void(0);").css("margin-right","17px"),a=x._label("span").addClass("btn-label"),i=x._label("i").addClass("glyphicon glyphicon-ok"),t.append(a.append(i)).append("提交"),t.click(function(){e&&e($(this))}),t)),n.append(d)}var d,l=$("#"+e),f=x._label("div");f._form=function(e,t){var a,i,n,d,l=$.extend(!0,{},t),r=(a=l,i=[],n=[],d=[],$.each(a,function(e,t){12===t.width?n.push(t):"createdt"===t.id||"updatedt"===t.id?d.push(t):i.push(t)}),{half:i,full:n,time:d});function p(e){if(12!==e.width)var t=x._label("section").addClass("col col-"+e.width);else t=x._label("section");var a=x._label("label").addClass("label").html(e.name);if("textarea"===e.type)var i=x._label("label").addClass("textarea has-warning"),n=x._label("textarea").attr("name",e.id).attr("placeholder",e.name);else i=x._label("label").addClass("input has-warning"),n=x._label("input").attr("name",e.id).attr("type",e.type).attr("placeholder",e.name);"select2"===n.attr("type")&&n.attr("type","input"),e.write||n.attr("readonly","readonly");var d=x._label("b").addClass("tooltip tooltip-bottom-right").html(e.name+"为必填项");return i.append(n).append(d),t.append(a).append(i),t}function o(e){var t=e/2;return Math.round(t)===t}var s=x._label("form").attr("onsubmit","return false;").addClass("smart-form"),c=$("<fieldset></fieldset>");s.append(c),$.each(r.half,function(e,t){var a=e/2;if(o(e)){var i=x._label("div").addClass("row");s.children().append(i)}else a-=.5;s.find("div").eq(a).append(p(t))});var h,u,m,f,b,g=null;$.each(r.time,function(e,t){o(e)&&(g=x._label("div").addClass("row")),g.append(p(t)),s.children().append(g);var a=$("<textarea>").attr("style","display:none").attr("name","help_info");c.append(a)}),$.each(r.full,function(e,t){s.children().append(p(t))}),h=s,u=x._label("footer"),m=x._label("button").addClass("btn btn-default").attr("data-dismiss","modal").html("取消"),f=x._label("button").addClass("btn btn-primary").attr("name","ide_submit").html("确定"),u.append(m).append(f),h.append(u),b=l,$.each(b,function(e,t){"status"===t.id&&zy.cache.initDicts("ZR.0001",function(){s.find("[name="+t.id+"]").zySelect("ZR.0001",!1,{allowClear:!1,width:"100%"}),s.find("[name="+t.id+"]").select2("val","1")}),"auflag"===t.id&&zy.cache.initDicts("ZR.0029",function(){s.find("[name="+t.id+"]").zySelect("ZR.0029",!1,{allowClear:!1,width:"100%"}),s.find("[name="+t.id+"]").select2("val","0")})}),e.append(s)},zy.net.loadHTML("ide/htmlide/ide_run.html",f,function(e){d=e});var a=x._label("div").addClass("row"),i=x._label("div").addClass("col-xs-12 col-sm-9").css({});i.unbind(),i.bind("size",function(e){$(this).removeClass();var t=$(this).siblings(":visible");if(0<t.length){var a=0;$.each(t,function(e,t){a+=Number($(t).attr("class").replace(/col-xs-12 col-sm-/g,""))}),$(this).addClass("col-xs-12 col-sm-"+(12-a))}else $(this).addClass("col-xs-12 col-sm-12")});var n,r,p,o,s,c,h,u,m,b,g,v=x._label("pre").attr("id","zy_ide_editor"),t=x._label("div").addClass("col-xs-12 col-sm-3").css({display:"none"}),y=function(){var e,t,a,i=x._label("div").addClass("col-xs-12 col-sm-3");e=i,t=x._label("div").addClass("input-group input-group-sm").attr("style","width:100%;margin-bottom:-15px"),(a=x._label("header")).append(x._label("label").html("API 列表")).append(x._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(x._label("i").addClass("fa fa-times"))),e.append(t.append(a)),e.append(x._label("legend")),a.children("a").unbind(),a.children("a").click(function(){var e=$(this).closest(".col-sm-3");e.hide(),e.parent().children(":eq(1)").trigger("size")});var n=x._label("ul").addClass("ztree").attr("id","maintree");return i.append(x._label("div").attr("style","overflow: auto;").addClass("row").css("margin-top","-15px").append(n)),function(e){var t=x._label("form").attr("onsubmit","return false;").addClass("smart-form"),a=x._label("_section").append(x._label("label").addClass("label").html("递交时的注解 (修改原因)")),i=x._label("label").addClass("textarea has-warning").append(z).append(x._label("b").addClass("tooltip tooltip-bottom-right").html("修改原因为必填项"));a.append(i),t.append($("<fieldset></fieldset>").append(a)),e.append(t);var n=setInterval(function(){t.height()<=0||(clearInterval(n),C=t.height()||105)},100)}(i),{container:i,ul:n}}();return l.closest("#widget-grid").after(f),v.attr("style","font-family:Consolas,Microsoft YaHei,微软雅黑,sans-serif,宋体;top:-14;height:100%; width:100%;"),a.append(y.container).append(i).append(t),l.find(".widget-body").empty().append(a),(n=l.children("header")).append(function(){function e(){var e=$("#zy_tabs").closest(".row").children(":last");$("#jarviswidget-fullscreen-mode").length,function(e,t){var a,i;e.empty(),a=x._label("div").addClass("input-group input-group-sm").attr("style","width:100%;margin-bottom:-15px"),(i=x._label("header")).append(x._label("label").html("按内容查询")).append(x._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(x._label("i").addClass("fa fa-times"))),e.append(a.append(i)),e.append(x._label("legend")),i.children("a").unbind(),i.children("a").click(function(){var e=$(this).closest(".col-sm-3");e.hide(),e.parent().children(":eq(1)").trigger("size")});var n=x._label("ul").addClass("ztree").attr("id","resulttree"),d=x._label("div").addClass("smart-form").attr("style","margin-top:-10px");e.append(d),e.append(x._label("legend"));var l,r,p,o,s=x._label("textarea ").attr("placeholder","内容").attr("rows","3"),c=(x._label("_label").addClass("glyphicon glyphicon-search").attr("rel","tooltip").attr("title","查询"),x._label("button").addClass("btn btn-default btn-xs pull-right").attr("style","margin-top:5px;margin-right:14px").html("查询")),h=x._label("i").addClass("fa fa-times pull-right").attr("style","margin-right:13px"),u=x._label("label").addClass("toggle state-error pull-left").attr("style","margin:4px 0 0 5px");u.append(x._label("input").attr("type","checkbox")).append(x._label("i").attr({"data-swchoff-text":"off","data-swchon-text":"on",title:"区分大小写"})),e.append(x._label("div").addClass("row").attr("style","margin-top:-10px;display:none").append(x._label("h").attr("style","margin-left:20px").html("查询结果")).append(h)),l="overflow:auto;display:none;height:",l+=_-400+"px",e.append(x._label("div").addClass("row").attr("style",l).append(n)),d.append(x._label("label").addClass("textarea").append(s)),d.append(x._label("div").addClass("row").attr("style","margin-bottom:-10px").append(u).append(c)),(o=h).unbind(),o.click(function(){var e=$(this).closest("div");e.hide(),e.next().hide(),e.prev().hide()}),r=c,p=u.children("input"),(r||p)&&(r.unbind(),r.click(function(){var e=p.prop("checked"),t={apiid:"querycontent"};t.r_param={roleid:w,content:s.val(),casesensitive:e},x._api(t,function(e){n.siblings().remove(),n.empty(),0===e.result.length?n.parent().append(x._label("div").css({"text-align":"center","vertical-align":"middle"}).html("空")):k({tree:{ztree:n},mod:f},e.result),n.parent().siblings(":hidden").show(),n.parent().show()})}))}(e),e.show(),$("#zy_tabs").parent().trigger("size")}function t(){var e=$("#zy_tabs").closest(".row").children(":last"),t=!1;0<$("#jarviswidget-fullscreen-mode").length&&(t=!0),function(e,t){function a(){var e=x._label("span").addClass("onoffswitch"),t=x._label("input").addClass("onoffswitch-checkbox").attr("type","checkbox").attr("name","start_interval").attr("id","start_interval"),a=x._label("label").addClass("onoffswitch-label").attr("for","start_interval");return a.append(x._label("span").addClass("onoffswitch-inner").attr("data-swchoff-text","Api").attr("data-swchon-text","Mod")).append(x._label("span").addClass("onoffswitch-switch")),e.append(t).append(a),{container:e,input:t}}var i,n;e.empty(),i=x._label("div").addClass("input-group input-group-sm").attr("style","width:100%;margin-bottom:-15px"),(n=x._label("header")).append(x._label("label").html("按name/id查询")).append(x._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(x._label("i").addClass("fa fa-times"))),e.append(i.append(n)),e.append(x._label("legend")),n.children("a").unbind(),n.children("a").click(function(){var e=$(this).closest(".col-sm-3");e.hide(),e.parent().children(":eq(1)").trigger("size")});var d=x._label("ul").addClass("ztree").attr("id","resulttree"),l=x._label("div").addClass("input-group input-group-sm").attr("style","margin:-10px 0-5px"),a=a();e.append(l),e.append(x._label("legend")),l.append(x._label("span").addClass("input-group-addon").append(a.container));var r=x._label("input").addClass("form-control").attr("placeholder","查询").attr("type","text"),p=x._label("_label").addClass("glyphicon glyphicon-search").attr("rel","tooltip").attr("title","查询"),o=x._label("button").addClass("btn btn-default").html("查询"),s=x._label("a").attr("href","javascript:void(0);").addClass("pull-right").append(x._label("i").addClass("fa fa-times")).attr("style","margin-right:13px");e.append(x._label("div").addClass("row").attr("style","margin-top:-10px;display:none").append(x._label("h").attr("style","margin-left:20px").html("查询结果")).append(s));var c,h,u,m="overflow:auto;display:none;height:";t&&(m="overflow:auto;display:none;height:"),m+=_-300+"px",e.append(x._label("div").addClass("row").attr("style",m).append(d)),l.append(x._label("div").addClass("icon-addon addon-sm").append(r).append(p)),l.append(x._label("span").addClass("input-group-btn").append(o)),(u=s).unbind(),u.click(function(){var e=$(this).closest("div");e.hide(),e.next().hide(),e.prev().hide()}),c=o,h=a.input,(c||h)&&(c.unbind(),c.click(function(){var e=h.prop("checked"),t={apiid:"queryidorname"};t.r_param={roleid:w,type:e?"mod":"api",content:r.val()},x._api(t,function(e){d.siblings().remove(),d.empty(),0===e.result.length?d.parent().append(x._label("div").css({"text-align":"center","vertical-align":"middle"}).html("空")):k({tree:{ztree:d},mod:f},e.result),d.parent().siblings(":hidden").show(),d.parent().show()})}))}(e,t),e.show(),$("#zy_tabs").parent().trigger("size")}var a,i,n=x._label("div").attr("role","menu").addClass("widget-toolbar").attr("title","功能表"),d=x._label("i").addClass("fa fa-align-justify dropdown-toggle").attr("data-toggle","dropdown"),l=x._label("ul").addClass("dropdown-menu pull-right");return n.append(x._label("div").addClass("btn-group").append(d).append(l)),a=[{id:"byid",name:"按 ID/名称 查找"},{id:"bycontent",name:"按 API 内容查找"}],i=l,$.each(a,function(e,t){var a=x._label("li").append(x._label("a").html(t.name)).attr("id",t.id);i.append(a)}),l.children().unbind(),l.children().click(function(){"byid"===$(this).attr("id")&&t(),"bycontent"===$(this).attr("id")&&e()}),n}()),n.append((r=x._label("div").attr("role","menu").addClass("widget-toolbar").attr("style","display:none;").attr("title","保存"),(p=x._label("i").addClass("glyphicon glyphicon-saved")).unbind(),p.click(function(){f.empty(),function(){var e=z.val().trim();if(""===e)return zy.ui.msg("提示","修改原因为必填项","w");var t=$("#zy_tabs").children("div:visible").find("pre").attr("id"),a=$("#zy_tabs").children("div:visible").find("div").attr("id"),i=ace.edit(t);zy.setEditorExOptions(i),$("#left-panel nav").bind("click",function(){i.destroy(),i.container.remove()});var n=$("#widget-grid").find("header .glyphicon-cloud-upload").closest(".widget-toolbar");i&&a&&($(this).btnDisable(!0),x._api({apiid:zy.fix_api_name("ucode"),r_param:{contentid:a,content:i.getValue().trim(),updatecmt:e}},function(e){e&&($(this).btnDisable(!1),zy.ui.msg("提示信息",e.msg||"API保存成功","s"),$(".modal").modal("hide"),n.trigger("show","00"))}))}()}),r.append(p))),n.append((o=x._label("div").attr("role","menu").addClass("widget-toolbar").attr("style","display:none;").attr("title","测试"),(s=x._label("i").addClass("glyphicon glyphicon-play")).unbind(),s.bind("_init",function(e,i,n){s.unbind("click"),i&&s.click(function(){var e,t,a={appid:i.appid,moduleid:i.moduleid,apiid:i.apiid};zy.g.am.app="ZYAPP_IDE",zy.g.am.mod="ZYMODULE_IDE",zy.net.get("api/getapiinfo",function(e){n=e.result[0].help_info},a,null,function(e){}),e=i,t=n,f.html(d),RunApi(e,t)})}),o.append(s))),n.append((c=x._label("div").attr("role","menu").addClass("widget-toolbar").attr("style","display:none;").attr("title","历史"),(h=x._label("i").addClass("glyphicon glyphicon-calendar")).unbind(),h.click(function(){var e=$("#zy_tabs").children("div:visible").find("pre").attr("id");zy.net.loadHTML("ide/htmlide/ide_his.html",f,function(){his(e)})}),c.append(h))),n.append(function(){var e=x._label("div").attr("role","menu").addClass("widget-toolbar").attr("style","display:none;").attr("title","更改状态");e.append(x._label("div").addClass("btn-group"));var l,t=x._label("i").addClass("glyphicon glyphicon-cloud-upload dropdown-toggle").attr("data-toggle","dropdown"),a=x._label("ul").addClass("dropdown-menu pull-right");return e.unbind("show"),e.bind("show",function(e,d){l||(l=!0,function(t,a){var e=I[t];if(e)return a(e);x._api({apitype:"api/",apiid:"getdict",appid:"ZYAPP_LOGIN",modid:"ZYMODULE_LOGIN",r_param:{typecd:t,orgid:"a297dfacd7a84eab9656675f61750078"}},function(e){I[t]=e,a(e)})}("ZR.0031",function(e){try{var t=$("#widget-grid").find("header .glyphicon-cloud-upload").closest(".widget-toolbar");(function(e,t){if(e.empty(),"50"!==t)return"60"!==t||(a=x._label("li").append(x._label("a").html("API已下线")).css({"text-align":"center","vertical-align":"middle"}),e.append(a),!1);var a=x._label("li").append(x._label("a").html("API已发布")).css({"text-align":"center","vertical-align":"middle"});return e.append(a),!1})(t.find("ul"),d)&&(a=e.result[0]["ZR.0031"],i=t.find("ul"),n=d,i.empty(),$.each(a,function(e,t){var a=x._label("li").append(x._label("a").attr("href","javascript:void(0);").html(t.name).attr("status",t.id));t.id==n&&(a.children().addClass("editable-disabled"),e=x._label("i").addClass("fa fa-gear fa-1x fa-spin"),a.children().append(e)),i.append(a),a.click(function(){var t=this;if(!(0<$(this).find("i").length)){var a=$(this).parent().find("i"),i=$("#zy_tabs").children("div:visible").find("div"),n=$(this).children().attr("status");x._api({apiid:"updatestability",r_param:{contentid:i.attr("id"),stability:n}},function(e){i.attr("stability",n),zy.ui.msg("提示","修改成功","s"),0<a.length?$(t).children().append(a):$(t).children().append(x._label("i").addClass("fa fa-gear fa-1x fa-spin"))})}})})),t.show()}catch(e){console.error("ide/htmlide/ide.js",e)}finally{l=!1}var a,i,n}))}),e.children().append(t).append(a).parent()}()),n.append((u=x._label("div").attr("role","menu").addClass("widget-toolbar").attr("title","API 列表"),(m=x._label("i").addClass("glyphicon glyphicon-folder-open")).unbind(),m.click(function(){y.container.is(":visible")?($(this).children().removeClass().addClass("glyphicon glyphicon-chevron-right"),y.container.hide()):($(this).children().removeClass().addClass("glyphicon glyphicon-chevron-left"),y.container.show()),$("#zy_tabs").parent().trigger("size")}),u.append(m))),n.append((b=x._label("div").attr("role","menu").addClass("widget-toolbar").attr("title","API返回通用数据结构"),(g=x._label("i").addClass("glyphicon glyphicon-list-alt")).unbind(),g.click(function(){zy.net.loadHTML("ide/htmlide/ide_message.html",f,function(){})}),b.append(g))),{wid:l,tree:{ztree:y.ul,container:y.container,sResultCon:y.sResult},pre:i,mod:f,result:t}}("ide"),m=function(h){function s(e){e.click(function(){var e=$("#widget-grid").find("header .glyphicon-cloud-upload").closest(".widget-toolbar"),t=h.wid.children("header").find(".glyphicon-saved").parent(),a=h.wid.children("header").find(".glyphicon-calendar").parent(),i=h.wid.children("header").find(".glyphicon-play");1==c.getCount()&&(u(!1),e.hide(),a.hide(),i.parent().hide(),t.hide())})}function e(){c.el.on("tabsbeforeactivate",function(e,t){var a=t.newPanel.children().children(),i=$("#widget-grid").find("header .glyphicon-cloud-upload").closest(".widget-toolbar"),n=h.wid.children("header").find(".glyphicon-saved").parent(),d=h.wid.children("header").find(".glyphicon-calendar").parent(),l=h.wid.children("header").find(".glyphicon-play");if(a.attr("id")){i.trigger("show",[a.attr("stability")]),l.parent().show();var r=t.newPanel.find("pre").attr("id")||"",p=t.newPanel.find("pre").attr("help_info")||"";if(""!=r){var o=r.split("--")[2],s=r.split("--")[1],c=r.split("--")[0];l.trigger("_init",[{appid:o,moduleid:s,apiid:c},p])}n.show(),d.show(),i.show()}else l.parent().hide(),n.hide(),d.hide(),i.hide()})}var t=h.pre,c=new zyTabs(t);return e(),{add:function(e,t,a,i){u(!0);var n=x._label("pre");n.attr("style","font-family:Consolas,Microsoft YaHei,微软雅黑,sans-serif,宋体;top:-14;height:100%; width:100%;").attr("id",i);var d=_-200,l=x._label("input").addClass("form-control").attr("readonly","readonly"),r=x._label("div").addClass("row").css("height",d).append(n).addClass("fix_size"),p=x._label("div").attr("style",_).append(r);t&&p.attr("id",t),a&&p.attr("stability",a);var o=c.AddTab(i,e,!0,p);return o?(c.active(o),{pre:c.el.find("[aria-hidden=false]").find("pre"),inputc:l}):(s(c.el.find("li[aria-selected=true]").find(".hover-transparent:has(i)")),{pre:n,inputc:l})},eventOn:e,delbtn:s}}(t);!function(){var e=navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),a="iphone os"==e.match(/iphone os/i),i="midp"==e.match(/midp/i),n="rv:1.2.3.4"==e.match(/rv:1.2.3.4/i),d="ucweb"==e.match(/ucweb/i),l="android"==e.match(/android/i),r="windows ce"==e.match(/windows ce/i),p="windows mobile"==e.match(/windows mobile/i);if(t||a||i||n||d||l||r||p){var o=window.screen.height;$("article").attr("style","overflow: auto;height:"+o+"px;"),$(window).resize(function(){$("article").attr("style","overflow: auto;height:"+o+"px;")})}}(),k(t),pageSetUp(),p=t,$("#left-panel a[href]").one("click",function(){window.onbeforeunload=null,$(window).unbind("resize"),l()}),p.tree.container,$("#zy_tabs").parent(),p.wid.find(".jarviswidget-fullscreen-btn").click(function(){var e,t=p.result.find("div:has(ul)");if(window.ee=t,$("#zy_tabs").find("div.row:has(pre)"),$("#zy_tabs").find("p").children(),0!=$("pre").length)var a=$("#zy_tabs").children("div:visible").find("pre"),i=$("#zy_tabs").children("div:visible").find("pre").attr("id");e=0<$("#jarviswidget-fullscreen-mode").length?(0!=$("pre").length&&(D=ace.edit(i),$("#left-panel nav").bind("click",function(){D.destroy(),D.container.remove()}),D.setOption("wrap",n),D.setOption("tabSize",2),r(a),zy.setEditorExOptions(D)),(e=$($(".col-xs-12.col-sm-3")[0]).children(":last").attr("style")).replace(/530/,"435")):(0!=$("pre").length&&(D=ace.edit(i),$("#left-panel nav").bind("click",function(){D.destroy(),D.container.remove()}),D.setOption("wrap",n),D.setOption("tabSize",2),r(a),zy.setEditorExOptions(D)),e=(e=$($(".col-xs-12.col-sm-3")[0]).children(":last").attr("style")).replace(/435/,"530"),$($(".col-xs-12.col-sm-3")[0]).children(":last").attr("style",e),(e=$($(".col-xs-12.col-sm-3")[0]).children(":last").attr("style")).replace(/435/,"525")),$($(".col-xs-12.col-sm-3")[0]).children(":last").attr("style",e),l()})}