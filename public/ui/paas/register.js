Register=function(){var e=t.prototype;function t(){return zy.log("new Register()"),zy.g.host.api=zy.net.getHttpUrl("/ds/"),zy.g.host.ui=zy.net.getHttpUrl(),this.Init(),this}function n(){$("#get_valwords").btnDisable(!0),$("#register-form label.verify input").blur(function(){validator.element($(this))?$("#get_valwords").btnDisable(!1):$("#get_valwords").btnDisable(!0)}).keyup(function(){$(this).triggerHandler("blur")}).focus(function(){$(this).triggerHandler("blur")})}return e._g={param:{}},e.Events={},e.Init=function(){var r;$("input[name=email]").detach(),$("#tel_register").btnDisable(!0),$("#email_register").btnDisable(!1),n(),r=60,$("#get_valwords").on("click",function(e){!function e(t){0==r?(t.btnDisable(!1),t.val("获取验证码"),r=60):(t.btnDisable(!0),t.val("重新发送"+r),r--,setTimeout(function(){e(t)},1e3))}($(this))})},validator=$("#register-form").validate({rules:{userid:{required:!0,minlength:4,maxlength:16,userunion:!0},tel:{required:!0,tel:!0,telunion:!0},email:{required:!0,email:!0,emailunion:!0},password:{required:!0,minlength:6,maxlength:16},valwords:{required:!0,minlength:6,maxlength:6},agree:{required:!0}},messages:{userid:{required:"请输入用户ID"},tel:{required:"请输入手机号码"},email:{required:"请输入电子邮箱"},password:{required:"请输入密码"},valwords:{required:"请输入验证码"},agree:{required:"请确认同意"}},onfocusout:function(e){$(e).valid()},onkeyup:function(e){$(e).valid()},errorElement:"b",errorPlacement:function(e,t){t.is(":checkbox")?e.appendTo(t.parent()).css("color","red"):e.appendTo(t.parent()).addClass("tooltip tooltip-top-right")},highlight:function(e,t,r){$(e).parent().addClass("has-error"),$(e).parent().find("i").css("color","red")},unhighlight:function(e,t,r){$(e).parent().removeClass("has-error"),$(e).parent().find("i").css("color","green")},submitHandler:function(e){zy.log("正在提交表单注册"),zy.g.am.app="ZYAPP_LOGIN",zy.g.am.mod="ZYMODULE_REG",zy.net.post("user/register",function(e){e&&(zy.log("register.success: "+JSON.stringify(e)),"0"==e.ret&&(zy.ui.msg("提示信息：","注册成功！","s"),window.location.href="login.html"))},$("#register-form").serialize(),null,function(e){e&&"1001"===e.ret&&zy.ui.msg("提示信息：","注册失败！","e")})}}),$.validator.addMethod("tel",function(e,t){var r=e.length;return this.optional(t)||11==r&&/^(13[0-9]|14[57]|15[012356789]|17[678]|18[0-9])[0-9]{8}$/.test(e)},"请输入正确的手机号码"),$.validator.addMethod("userunion",function(e,t){var r;return $.ajaxSetup({async:!1}),zy.g.am.app="ZYAPP_LOGIN",zy.g.am.mod="ZYMODULE_REG",zy.net.post("user/get_havinguser",function(e){r=e.result&&"1"==e.result[0].count},{userid:e}),$.ajaxSetup({async:!0}),this.optional(t)||r},"该用户ID已被注册"),$.validator.addMethod("telunion",function(e,t){var r;return $.ajaxSetup({async:!1}),zy.g.am.app="ZYAPP_LOGIN",zy.g.am.mod="ZYMODULE_REG",zy.net.post("user/get_havinguser",function(e){r=e.result&&"1"==e.result[0].count},{tel:e}),$.ajaxSetup({async:!0}),this.optional(t)||r},"该手机号码已被注册"),$.validator.addMethod("emailunion",function(e,t){var r;return $.ajaxSetup({async:!1}),zy.g.am.app="ZYAPP_LOGIN",zy.g.am.mod="ZYMODULE_REG",zy.net.post("user/get_havinguser",function(e){r=e.result&&"1"==e.result[0].count},{email:e}),$.ajaxSetup({async:!0}),this.optional(t)||r},"该电子邮箱已被注册"),$(".register").on("click","button",function(){$current=$(this),$other=$(this).parent().siblings().find("button"),currentName=$(this).attr("name"),otherName=$(this).parent().siblings().find("button").attr("name"),$current.btnDisable(!0).addClass("btn-primary"),$other.btnDisable(!1).removeClass("btn-primary"),$("input[name="+otherName+"]").detach(),$(this).is("#tel_register")?$("#"+currentName).parent().find("i").after('<input type="text" name="tel" placeholder="手机号码">'):$("#"+currentName).parent().find("i").after('<input type="text" name="email" placeholder="电子邮箱">'),$("#register-form label").removeClass("has-error"),$("#register-form label i").removeAttr("style"),validator.resetForm(),$("#get_valwords").btnDisable(!0),n()}),t}();