!function(e){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&module.exports?module.exports=e():window.pym=e.call(this)}(function(){var a="xPYMx",r={},i=function(e){var t=new RegExp("[\\?&]"+e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},h=function(e,t){if("*"===t.xdomain||e.origin.match(new RegExp(t.xdomain+"$")))return!0},o=function(e,t,s){return["pym",e,t,s].join(a)};return r.Parent=function(e,t,s){var i;for(var n in this.id=e,this.url=t,this.el=document.getElementById(e),this.iframe=null,this.settings={xdomain:"*"},this.messageRegex=(i=this.id,new RegExp("^"+["pym",i,"(\\S+)","(.+)"].join(a)+"$")),this.messageHandlers={},s=s||{},this._constructIframe=function(){var e=this.el.offsetWidth.toString();this.iframe=document.createElement("iframe");var t="",s=this.url.indexOf("#");-1<s&&(t=this.url.substring(s,this.url.length),this.url=this.url.substring(0,s)),this.url.indexOf("?")<0?this.url+="?":this.url+="&",this.iframe.src=this.url+"initialWidth="+e+"&childId="+this.id+"&parentUrl="+encodeURIComponent(window.location.href)+t,this.iframe.setAttribute("width","100%"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("marginheight","0"),this.iframe.setAttribute("frameborder","0"),this.el.appendChild(this.iframe),window.addEventListener("resize",this._onResize)},this._onResize=function(){this.sendWidth()}.bind(this),this._fire=function(e,t){if(e in this.messageHandlers)for(var s=0;s<this.messageHandlers[e].length;s++)this.messageHandlers[e][s].call(this,t)},this.remove=function(){window.removeEventListener("message",this._processMessage),window.removeEventListener("resize",this._onResize),this.el.removeChild(this.iframe)},this._processMessage=function(e){if(h(e,this.settings)&&"string"==typeof e.data){var t=e.data.match(this.messageRegex);if(!t||3!==t.length)return!1;var s=t[1],i=t[2];this._fire(s,i)}}.bind(this),this._onHeightMessage=function(e){var t=parseInt(e);this.iframe.setAttribute("height",t+"px")},this._onNavigateToMessage=function(e){document.location.href=e},this.onMessage=function(e,t){e in this.messageHandlers||(this.messageHandlers[e]=[]),this.messageHandlers[e].push(t)},this.sendMessage=function(e,t){this.el.getElementsByTagName("iframe")[0].contentWindow.postMessage(o(this.id,e,t),"*")},this.sendWidth=function(){var e=this.el.offsetWidth.toString();this.sendMessage("width",e)},s)this.settings[n]=s[n];return this.onMessage("height",this._onHeightMessage),this.onMessage("navigateTo",this._onNavigateToMessage),window.addEventListener("message",this._processMessage,!1),this._constructIframe(),this},r.Child=function(e){this.parentWidth=null,this.id=null,this.parentUrl=null,this.settings={renderCallback:null,xdomain:"*",polling:0},this.messageRegex=null,this.messageHandlers={},e=e||{},this.onMessage=function(e,t){e in this.messageHandlers||(this.messageHandlers[e]=[]),this.messageHandlers[e].push(t)},this._fire=function(e,t){if(e in this.messageHandlers)for(var s=0;s<this.messageHandlers[e].length;s++)this.messageHandlers[e][s].call(this,t)},this._processMessage=function(e){if(h(e,this.settings)&&"string"==typeof e.data){var t=e.data.match(this.messageRegex);if(t&&3===t.length){var s=t[1],i=t[2];this._fire(s,i)}}}.bind(this),this._onWidthMessage=function(e){var t=parseInt(e);t!==this.parentWidth&&(this.parentWidth=t,this.settings.renderCallback&&this.settings.renderCallback(t),this.sendHeight())},this.sendMessage=function(e,t){window.parent.postMessage(o(this.id,e,t),"*")},this.sendHeight=function(){var e=document.getElementsByTagName("body")[0].offsetHeight.toString();this.sendMessage("height",e)}.bind(this),this.scrollParentTo=function(e){this.sendMessage("navigateTo","#"+e)},this.navigateParentTo=function(e){this.sendMessage("navigateTo",e)},this.id=i("childId")||e.id,this.messageRegex=new RegExp("^pym"+a+this.id+a+"(\\S+)"+a+"(.+)$");var t=parseInt(i("initialWidth"));for(var s in this.parentUrl=i("parentUrl"),this.onMessage("width",this._onWidthMessage),e)this.settings[s]=e[s];return window.addEventListener("message",this._processMessage,!1),this.settings.renderCallback&&this.settings.renderCallback(t),this.sendHeight(),this.settings.polling&&window.setInterval(this.sendHeight,this.settings.polling),this},function(){for(var e=document.querySelectorAll("[data-pym-src]:not([data-pym-auto-initialized])"),t=e.length,s=0;s<t;++s){var i=e[s];i.setAttribute("data-pym-auto-initialized",""),""===i.id&&(i.id="pym-"+s);var n=i.getAttribute("data-pym-src"),a=i.getAttribute("data-pym-xdomain"),h={};a&&(h.xdomain=a),new r.Parent(i.id,n,h)}}(),r});